/*! For license information please see telekinesis.js.LICENSE.txt */
(()=>{var t={26:function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))},r=this&&this.__await||function(t){return this instanceof r?(this.v=t,this):new r(t)},s=this&&this.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(e){return new Promise((function(n,r){!function(t,e,i,n){Promise.resolve(n).then((function(e){t({value:e,done:i})}),e)}(n,r,(e=t[i](e)).done,e.value)}))}}},o=this&&this.__asyncDelegator||function(t){var e,i;return e={},n("next"),n("throw",(function(t){throw t})),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,s){e[n]=t[n]?function(e){return(i=!i)?{value:r(t[n](e)),done:"return"===n}:s?s(e):e}:s}},a=this&&this.__asyncGenerator||function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,s=i.apply(t,e||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){s[t]&&(n[t]=function(e){return new Promise((function(i,n){o.push([t,e,i,n])>1||l(t,e)}))})}function l(t,e){try{(i=s[t](e)).value instanceof r?Promise.resolve(i.value.v).then(u,h):f(o[0][2],i)}catch(t){f(o[0][3],t)}var i}function u(t){l("next",t)}function h(t){l("throw",t)}function f(t,e){t(e),o.shift(),o.length&&l(o[0][0],o[0][1])}};Object.defineProperty(e,"__esModule",{value:!0}),e.RequestMetadata=e.Route=e.Channel=e.Session=e.Connection=void 0;const l=i(121),u=i(591),h=i(297),f=i(988),c=void 0!==i.g&&1==(null===i.g||void 0===i.g?void 0:i.g.isNode),d=c?i.g.crypto:crypto,p=c?i.g.WebSocket:WebSocket;e.Connection=class{constructor(t,e="ws://localhost:8776"){this.RESEND_TIMEOUT=2,this.MAX_SEND_RETRIES=3,this.session=t,this.url=e,this.tOffset=0,this.awaitingAck=new Map,t.connections.push(this)}connect(t=0){return new Promise(((e,i)=>n(this,void 0,void 0,(function*(){void 0!==this.websocket&&(this.websocket.close(),this.websocket=void 0),this.websocket=new p(this.url),this.websocket.onerror=r=>{t<this.MAX_SEND_RETRIES?(console.warn(`Failed connecting to ${this.url}. Retrying: ${t+1} of ${this.MAX_SEND_RETRIES}`),setTimeout((()=>n(this,void 0,void 0,(function*(){return e(yield this.connect(t+1))}))),1e3*this.RESEND_TIMEOUT)):i(r)};let r=[],s=[],o=()=>new Promise((t=>r.length>0?t(r.splice(0,1)[0]):s.push(t)));this.websocket.onmessage=t=>n(this,void 0,void 0,(function*(){let e=c?t.data:yield fetch(URL.createObjectURL(t.data)).then((t=>t.arrayBuffer())),i=new Uint8Array(e);if(s.length>0)for(var n in s){let t=s.pop();t&&t(i)}else r.push(i)}));let a=yield o(),l=yield this.session.sessionKey.sign(a),u=(new TextEncoder).encode(yield this.session.sessionKey.publicSerial(!1)),g=d.getRandomValues(new Uint8Array(32)),_=(new TextEncoder).encode(JSON.stringify({version:"0.1.60"}));this.websocket.send(new Uint8Array([...l,...u,...g,..._])),this.tOffset=Date.now()/1e3-(0,f.bytesToInt)(a.slice(32,36));let b=yield o(),w=(new TextDecoder).decode(b.slice(64,152)),v=new h.PublicKey("verify",w),m=JSON.parse((new TextDecoder).decode(b.slice(152)));m.hasOwnProperty("entrypoint")&&m.entrypoint&&(this.entrypoint=y.fromObject(m.entrypoint)),m.hasOwnProperty("peers")&&m.peers&&(this.brokerPeers=m.peers);try{yield v.verify(b.slice(0,64),g)}catch(t){return this.websocket.close(),delete this.websocket,void i(t)}this.websocket.onmessage=t=>n(this,void 0,void 0,(function*(){return this.recv(t)})),this.brokerId=w,this.websocket.onerror=t=>{console.warn(`Connection to ${this.url} closed: ${JSON.stringify(t,void 0,2)}. Reconnecting...`),setTimeout((()=>this.connect()),1e3*this.RESEND_TIMEOUT)},e(this)}))))}recv(t){return n(this,void 0,void 0,(function*(){let e=c?t.data:yield fetch(URL.createObjectURL(t.data)).then((t=>t.arrayBuffer())),i=new Uint8Array(e),n=i.slice(0,64),r=(0,f.bytesToInt)(i.slice(64,68));if(this.session.checkNoRepeat(n,r+this.tOffset)){let t=(0,f.bytesToInt)(i.slice(68,70)),e=(0,f.bytesToInt)(i.slice(70,73)),s=JSON.parse((new TextDecoder).decode(i.slice(73,73+t))),o=i.slice(73+t,73+t+e);for(let e in s)if("send"===s[e][0]){let a=s[e][1],l=new h.PublicKey("verify",a.source.session[0]);try{if(yield l.verify(n,i.slice(64,73+t+65+32)),this.session.channels.has(a.destination.channel))if(255==o[0])this.ack(a.source.session[0],(0,f.b64encode)(o.slice(1,65)));else{let e=0==o[0]?n:o.slice(1,65);yield this.send([["send",{source:a.destination,destination:a.source}]],void 0,void 0,new Uint8Array([255,...e]));let s=o.slice(97),l=new Uint8Array(yield d.subtle.digest("SHA-256",s));if(o.slice(65,97).reduce(((t,e,i)=>t&&e===l[i]),!0)&&(e.reduce(((t,e,i)=>t&&e===n[i]),!0)||this.session.checkNoRepeat(e,r+this.tOffset))){let e=this.session.channels.get(a.destination.channel);e&&(yield e.handleMessage(y.fromObject(a.source),y.fromObject(a.destination),s,i.slice(0,73+t+65+32)))}}}catch(t){console.error("On receive message error: "+t)}}}}))}send(t,e=new Uint8Array,i,r){return new Promise(((i,s)=>n(this,void 0,void 0,(function*(){var o,a,l,u,h;const c=(i,s)=>n(this,void 0,void 0,(function*(){let n=(new TextEncoder).encode(JSON.stringify(t)),o=r||(s&&i?new Uint8Array([s,...(0,f.b64decode)(i)]):new Uint8Array(65)),a=new Uint8Array(yield d.subtle.digest("SHA-256",e)),l=new Uint8Array([...(0,f.intToBytes)(Date.now()/1e3-this.tOffset,4),...(0,f.intToBytes)(n.length,2),...(0,f.intToBytes)(e.length+32+65,3),...n,...o,...a]),u=yield this.session.sessionKey.sign(l);return[u,new Uint8Array([...u,...l,...e])]}));let[p,y]=yield c();const g=t.map((([t,e])=>t)).includes("send")&&null==r,_=(0,f.b64encode)(p);g&&this.awaitingAck.set(_,[t,i]);for(let e in Array(this.MAX_SEND_RETRIES+1).fill(0)){if((void 0===this.websocket||this.websocket.readyState>1)&&(yield this.connect()),void 0!==this.websocket&&this.websocket.send(y),!g){i(void 0);break}if(yield new Promise((t=>setTimeout(t,1e3*this.RESEND_TIMEOUT))),!this.awaitingAck.has(_))break;if(parseInt(e)===this.MAX_SEND_RETRIES){this.awaitingAck.delete(_);const e=t.filter((([t,e])=>"send"===t))[0][1];s(`${null===(o=null==e?void 0:e.source)||void 0===o?void 0:o.session[0].slice(0,4)} send ${null===(a=null==e?void 0:e.destination)||void 0===a?void 0:a.session[0].slice(0,4)} ${null===(l=e.destination)||void 0===l?void 0:l.session[1].slice(0,2)} - ${null===(h=null===(u=null==e?void 0:e.destination)||void 0===u?void 0:u.channel)||void 0===h?void 0:h.slice(0,4)} max retries reached `)}else[p,y]=yield c(_,parseInt(e))}}))))}ack(t,e){if(this.awaitingAck.has(e)){const[i,n]=this.awaitingAck.get(e);if(void 0!==i)for(let[r,s]of i)"send"===r&&s.destination.session[0]===t&&(this.awaitingAck.delete(e),n(void 0))}}clear(t){}close(){this.websocket&&(this.websocket.onerror=()=>{},this.websocket.close(1e3))}},e.Session=class{constructor(t){this.sessionKey=new h.PrivateKey("sign",t),this.instanceId=(0,f.b64encode)(Uint8Array.from(d.getRandomValues(new Uint8Array(6)))),this.channels=new Map,this.connections=[],this.seenMessages=[new Set,new Set,0],this.issuedTokens=new Map,this.targets=new Map,this.routes=new Map}toString(){var t;return`Session ${null===(t=this.sessionKey.repr)||void 0===t?void 0:t.slice(0,4)} ${this.instanceId.slice(0,2)}`}checkNoRepeat(t,e){let i=Date.now()/1e3,n=Math.floor(i/60),r=(0,f.b64encode)(t);return this.seenMessages[2]!=n&&(this.seenMessages[n%2]=new Set,this.seenMessages[2]=n),i-60+4<=e&&e<i+4&&!this.seenMessages[0].has(r)&&!this.seenMessages[1].has(r)&&(this.seenMessages[n%2].add(r),!0)}issueToken(t,e,i){return n(this,void 0,void 0,(function*(){let n,r,s,o;t instanceof h.Token?(n="extension",r=t,s=t.signature):(n="root",s=t);let a=!1;for(var l of this.issuedTokens.values())if(o=l[0],o.asset===s&&o.receiver===e&&o.tokenType===n&&o.maxDepth===i){for(var u in this.connections)if(this.connections[u].brokerId&&o.brokers.includes(this.connections[u].brokerId)){r=l[1],a=!0;break}if(a)break}if(!a){o=new h.Token(yield this.sessionKey.publicSerial(!1),this.connections.map((t=>t.brokerId)),e,s,n||"root",i);let t=yield o.sign(this.sessionKey);this.issuedTokens.set(t,[o,r])}return o&&o.encode()}))}extendRoute(t,e,i){return n(this,void 0,void 0,(function*(){let n;if(t.session[0]===(yield this.sessionKey.publicSerial(!1)))return n=yield this.issueToken(t.channel,e,i),void(t.tokens=[n]);{for(var r in t.tokens){let i=yield h.Token.decode(t.tokens[r]);if(i.receiver===(yield this.sessionKey.publicSerial(!1))&&(t.tokens=t.tokens.slice(0,parseInt(r)+1)),i.receiver===e)return void(t.tokens=t.tokens.slice(0,parseInt(r)+1))}let s=yield h.Token.decode(t.tokens[t.tokens.length-1]);n=yield this.issueToken(s,e,i)}t.tokens.push(n)}))}clear(t){for(var e in this.connections)this.connections[e].clear(t)}send(t,e=new Uint8Array([]),i){return n(this,void 0,void 0,(function*(){for(var n in this.connections){let r=this.connections[n];yield r.send(t,e,i)}}))}},e.Channel=class{constructor(t,e,i=!1){this.MAX_PAYLOAD_LEN=Math.pow(2,19),this.MAX_COMPRESSION_LEN=Math.pow(2,19),this.MAX_OUTBOX=Math.pow(2,4),this.session=t,this.channelKey=new h.PrivateKey("derive",e),this.isPublic=i,this.headerBuffer=[],this.chunks=new Map,this.messages=[],this.waiting=[],this.initLocks=[],this.then=this._then,this.channelKey.publicSerial(!1).then((t=>{this.session.channels.set(t,this),this.session.sessionKey.publicSerial(!1).then((e=>{for(var i in this.route=new y(this.session.connections.map((t=>t.brokerId)),[e,this.session.instanceId],t,[]),this.initLocks)this.initLocks[i](this);this.initLocks=[]}))}))}toString(){var t,e;return`Channel ${null===(t=this.session.sessionKey.repr)||void 0===t?void 0:t.slice(0,4)} ${this.session.instanceId.slice(0,2)} - ${null===(e=this.channelKey.repr)||void 0===e?void 0:e.slice(0,4)}`}handleMessage(t,e,i,r){var s;return n(this,void 0,void 0,(function*(){if(yield this.validateTokenChain(t.session[0],e.tokens)){let e,n=new h.SharedKey(this.channelKey,t.channel),o=new Uint8Array(yield n.decrypt(i.slice(16),i.slice(0,16))),a=new g(this.session,t,[{raw_payload:i,shared_key:n.key,proof:r}]),c=new Uint8Array;if(0===(0,f.bytesToInt)(o.slice(0,4)))c=o.slice(4);else{let e=(0,f.bytesToInt)(o.slice(0,2)),i=(0,f.bytesToInt)(o.slice(2,4)),n=t.session[0]+(0,f.bytesToInt)(o.slice(4,8)),r=o.slice(8);this.chunks.has(n)||this.chunks.set(n,new Map);let l=this.chunks.get(n);if(l.set(e,[r,a]),l.size!==i)return;for(let t=0;t<i;t++){let i=l.get(t);c=new Uint8Array([...c,...i[0]]),t!=e&&(null===(s=a.rawMessages)||void 0===s||s.push(i[1]))}this.chunks.delete(n)}if(0===c[0])e=(0,l.deserialize)(c.slice(1));else{const t=(0,u.inflate)(c.slice(1));e=(0,l.deserialize)(t)}if(this.session.messageListener&&this.session.messageListener(a),this.telekinesis&&this.telekinesis._handleRequest)this.telekinesis._handleRequest(this,a,e);else if(this.waiting.length>0){let t=this.waiting.pop();t&&t([a,e])}else this.messages.push([a,e])}else console.error(`Invalid Tokens: ${t.session[0].slice(0,4)} ${t.channel.slice(0,4)} ||| ${e.session[0].slice(0,4)} ${e.channel.slice(0,4)} [${e.tokens}]`)}))}recv(){return n(this,void 0,void 0,(function*(){return new Promise((t=>this.messages.length>0?t(this.messages.splice(0,1)[0]):this.waiting.push(t)))}))}listen(){function t(t){if(void 0!==t.route){let e={brokers:t.route.brokers,session:t.route.session,channel:t.route.channel,is_public:t.isPublic};t.headerBuffer.push(["listen",e])}}return void 0===this.route?this.initLocks.push(t):t(this),this.then=this._then,this}send(t,e){return n(this,void 0,void 0,(function*(){if(void 0===this.route&&(yield new Promise((t=>this.initLocks.push(t)))),void 0!==this.route){function i(t,e,n,l,u,h){return a(this,arguments,(function*(){let a=new Uint8Array;if(h<u){if(1===u)a=new Uint8Array([0,0,0,0,...t]);else{if(u>Math.pow(2,16))throw`Payload size ${t.length/Math.pow(2,20)} MiB is too large`;a=new Uint8Array([...(0,f.intToBytes)(h,2),...(0,f.intToBytes)(u,2),...l,...t.slice(h*e,(h+1)*e)])}let c=d.getRandomValues(new Uint8Array(16));yield yield r(new Uint8Array([...c,...yield r(n.encrypt(a,c))])),yield r(yield*o(s(yield r(i(t,e,n,l,u,h+1)))))}}))}function c(t,e,i,r){var o,a,l,u;return n(this,void 0,void 0,(function*(){try{for(o=s(i);!(a=yield o.next()).done;){let i=a.value;yield t.execute(e,i,r)}}catch(t){l={error:t}}finally{try{a&&!a.done&&(u=o.return)&&(yield u.call(o))}finally{if(l)throw l.error}}}))}let p=this.route.clone();yield this.session.extendRoute(p,t.session[0]),this.listen();let y=new Uint8Array((0,l.serialize)(e));if(y.length<this.MAX_COMPRESSION_LEN){const x=(0,u.deflate)(y);y=new Uint8Array([255,...x])}else y=new Uint8Array([0,...y]);let g=d.getRandomValues(new Uint8Array(4)),_=new h.SharedKey(this.channelKey,t.channel),b=["send",{source:p.toObject(),destination:t.toObject()}],w=Math.floor((y.length-1)/this.MAX_PAYLOAD_LEN)+1,v=Math.min(w,this.MAX_OUTBOX),m=i(y,this.MAX_PAYLOAD_LEN,_,g,w,0);try{yield Promise.all(Array(v).fill(0).map((()=>new Promise(((t,e)=>{c(this,b,m,g).then(t).catch(e)})))))}catch(S){throw this.session.clear(g),S}return new Promise((t=>t(this)))}}))}execute(t,e=new Uint8Array,i){return n(this,void 0,void 0,(function*(){if(void 0===this.route&&(yield new Promise((t=>this.initLocks.push(t)))),void 0!==this.route&&(this.headerBuffer.length>0||void 0!==t)){let n=void 0!==t?this.headerBuffer.concat([t]):this.headerBuffer,r=1,s=[[]];for(let t of n){let e=JSON.stringify(t).length;r+e+1<Math.pow(256,2)?(s[s.length-1].push(t),r+=e+1):(s.push([t]),r=e+2)}for(let t of s)yield this.session.send(t,t.map((([t,e])=>t)).includes("send")?e:void 0,i),this.headerBuffer=[]}return this.then=void 0,new Promise((t=>t(this)))}))}_then(t){0===this.headerBuffer.length&&void 0!==this.route?(this.then=void 0,t(this)):this.execute().then((()=>t(this))).catch((t=>console.log("Error in channel._then",t)))}close(){var t;return n(this,void 0,void 0,(function*(){for(var e in this.session.connections){let i=this.session.connections[e],n=yield null===(t=this.route)||void 0===t?void 0:t.toObject();yield i.send([["close",n]])}for(var e in this.waiting)this.waiting[e]([void 0,void 0])}))}validateTokenChain(t,e){return n(this,void 0,void 0,(function*(){let i=yield this.session.sessionKey.publicSerial(!1);if(this.isPublic||t===i)return!0;if(0===e.length)return!1;let n=yield this.channelKey.publicSerial(!1),r=i,s=null;for(let o in e){let a;try{a=yield h.Token.decode(e[o])}catch(t){if("Invalid Signature"===t.message)return!1;throw t}if(a.asset===n&&a.issuer===r&&a.signature){if(a.issuer===i&&!this.session.issuedTokens.has(a.signature))return!1;if(a.maxDepth&&(null===s||a.maxDepth+o<s)&&(s=a.maxDepth+o),null===s||o<s){if(r=a.receiver,n=a.signature,r===t)return!0;continue}}return!1}return!1}))}};class y{constructor(t,e,i,n,r){this.brokers=t,this.session=e,this.channel=i,this.tokens=n,this._hash=this.session.join("")+this.channel,this._parentChannel=r}toObject(){return{brokers:this.brokers,session:this.session,channel:this.channel,tokens:this.tokens}}toString(){return`Route ${this.session[0].slice(0,4)} ${this.session[1].slice(0,2)} - ${this.channel.slice(0,4)}`}clone(){return y.fromObject(this.toObject())}validateTokenChain(t){return n(this,void 0,void 0,(function*(){if(this.session[0]!==t){if(!(this.tokens.length>0))throw"Invalid token chain 0";let e;for(let i in this.tokens){let n=yield h.Token.decode(this.tokens[i]);if(e=e||n,"0"===i&&(n.asset!=this.channel||"root"!=n.tokenType||n.issuer!=this.session[0])||"0"!==i&&(n.issuer!==e.receiver||n.asset!==e.signature||"extension"!==n.tokenType)||i===this.tokens.length.toString()&&n.receiver!==t)throw"Invalid token chain";if(n.receiver===t)break}}return!0}))}static fromObject(t){return new y(t.brokers,t.session,t.channel,t.tokens)}}e.Route=y;class g{constructor(t,e,i){this._session=t,this.sessionPublicKey="",t.sessionKey.publicSerial(!1).then((t=>{this.sessionPublicKey=t})),this.caller=e,this.rawMessages=i}}e.RequestMetadata=g},297:function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Token=e.SharedKey=e.PublicKey=e.PrivateKey=void 0;const r=i(988),s="undefined"==typeof crypto?i.g.crypto:crypto;e.PrivateKey=class{constructor(t,e,i){if(this.exportedKey=e,this.name=e?e.split("-----END PRIVATE KEY-----").slice(1).join("-----END PRIVATE KEY-----").replace("\n",""):i,"sign"===t)return this._algorithm="ECDSA",void(this._usage=["sign"]);this._algorithm="ECDH",this._usage=["deriveKey"]}generate(){return n(this,void 0,void 0,(function*(){if(void 0!==this.exportedKey){let t,e;t=yield s.subtle.importKey("pkcs8",(0,r.b64decode)(this.exportedKey.split("-----END PRIVATE KEY-----")[0].split("\n").slice(1).join("")),{name:this._algorithm,namedCurve:"P-256"},!0,this._usage),e=yield s.subtle.exportKey("jwk",t),this.key={privateKey:t,publicKey:yield s.subtle.importKey("jwk",{alg:e.alg,crv:e.crv,ext:!0,key_ops:[],kty:e.kty,x:e.x,y:e.y},{name:this._algorithm,namedCurve:"P-256"},!0,[])}}else this.key=yield s.subtle.generateKey({name:this._algorithm,namedCurve:"P-256"},!0,this._usage);return this}))}sign(t){return n(this,void 0,void 0,(function*(){if(void 0===this.key&&(yield this.generate()),void 0!==this.key){let e=yield s.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},this.key.privateKey,t);return new Uint8Array(e)}throw new Error("key is undefined")}))}publicSerial(t=!0){return n(this,void 0,void 0,(function*(){if(void 0===this.key&&(yield this.generate()),void 0!==this.key){let e=(yield s.subtle.exportKey("raw",this.key.publicKey)).slice(1),i=(this.name&&t?`${this.name}.`:"")+(0,r.b64encode)(new Uint8Array(e));return void 0===this.repr&&(this.repr=i),i}throw new Error("key is undefined")}))}exportKey(){return n(this,void 0,void 0,(function*(){if(null==this.exportedKey){if(void 0===this.key&&(yield this.generate()),void 0===this.key)throw new Error("key is undefined");this.exportedKey="-----BEGIN PRIVATE KEY-----\n"+(0,r.b64encode)(new Uint8Array(yield s.subtle.exportKey("pkcs8",this.key.privateKey)))+"\n-----END PRIVATE KEY-----"+(this.name?`\n${this.name}`:"")}return this.exportedKey}))}};class o{constructor(t,e){if(this.publicSerial=e,this.name=e.split(".").slice(0,-1).join("."),"verify"===t)return this._algorithm="ECDSA",void(this._usage=["verify"]);if("derive"===t)return this._algorithm="ECDH",void(this._usage=[]);throw new Error("expected input 'use' should be 'verify' or 'derive'")}generate(){return n(this,void 0,void 0,(function*(){let t=(0,r.b64decode)(this.publicSerial.split("\n").slice(-1)[0]);return this.key=yield s.subtle.importKey("raw",new Uint8Array([4,...t]).buffer,{name:this._algorithm,namedCurve:"P-256"},!0,this._usage),this}))}verify(t,e){return n(this,void 0,void 0,(function*(){if(void 0===this.key&&(yield this.generate()),void 0!==this.key){if(yield s.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},this.key,t,e))return;throw new Error("Invalid Signature")}throw new Error("key is undefined")}))}}e.PublicKey=o,e.SharedKey=class{constructor(t,e){this.publicSerial=e,this.privateKey=t}generate(){return n(this,void 0,void 0,(function*(){if(void 0===this.privateKey.key&&(yield this.privateKey.generate()),void 0!==this.privateKey.key)return this.key=yield s.subtle.deriveKey({name:"ECDH",public:(yield new o("derive",this.publicSerial).generate()).key},this.privateKey.key.privateKey,{name:"AES-CTR",length:256},!1,["encrypt","decrypt"]),this}))}encrypt(t,e){return n(this,void 0,void 0,(function*(){if(void 0===this.key&&(yield this.generate()),void 0!==this.key){let i=yield s.subtle.encrypt({name:"AES-CTR",counter:e,length:128},this.key,t);return new Uint8Array(i)}}))}decrypt(t,e){return n(this,void 0,void 0,(function*(){if(void 0===this.key&&(yield this.generate()),void 0!==this.key)return yield s.subtle.encrypt({name:"AES-CTR",counter:e,length:128},this.key,t)}))}};class a{constructor(t,e,i,n,r,s,o,a,l={}){this.issuer=t,this.brokers=e,this.receiver=i,this.asset=n,this.tokenType=r,this.maxDepth=s||null,this.validFrom=o||Date.now()/1e3,this.validUntil=a||null,this.metadata=l}verify(t){return n(this,void 0,void 0,(function*(){try{return yield new o("verify",this.issuer).verify((0,r.b64decode)(t),(new TextEncoder).encode(this.toString())),this.signature=t,!0}catch(t){return!1}}))}toString(){return JSON.stringify(this.toObj())}toObj(){return{issuer:this.issuer,brokers:this.brokers,receiver:this.receiver,asset:this.asset,token_type:this.tokenType,max_depth:this.maxDepth,valid_from:this.validFrom,valid_until:this.validUntil,metadata:this.metadata}}encode(){if(void 0===this.signature)throw"You need to sign the token before encoding it";return this.signature+"."+this.toString()}sign(t){return n(this,void 0,void 0,(function*(){return this.signature=(0,r.b64encode)(yield t.sign((new TextEncoder).encode(this.toString()))),this.signature}))}static decode(t,e=!0){return n(this,void 0,void 0,(function*(){let i=JSON.parse(t.substr(t.indexOf(".")+1)),n=new a(i.issuer,i.brokers,i.receiver,i.asset,i.token_type,i.max_depth,i.valid_from,i.valid_until,i.metadata),r=t.substring(0,t.indexOf("."));return e?(yield n.verify(r))?n:void console.error("Invalid Signature"):(n.signature=r,n)}))}}e.Token=a},13:function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.createEntrypoint=e.Entrypoint=e.authenticate=void 0;const r=i(26),s=i(516);e.authenticate=function(t="ws://localhost:8776",e,i=console.log,r){return n(this,void 0,void 0,(function*(){let a;a="string"==typeof t?new o(t,e):t;let l=!1,u=yield a.authenticate._call([function(...t){return n(this,void 0,void 0,(function*(){if(!l){if(l=!0,t[0]!==(yield a._session.sessionKey.publicSerial()))throw new s.PermissionError("Public keys don't match");if(!i)return;t=["Your session public key is:\n"+t[0],...t.slice(1)]}return yield i.apply(null,t),i}))}],r);if(!l)throw new s.PermissionError("Session Public Key was never checked");return u}))};class o{constructor(t="ws://localhost:8776",e,...i){if(!/(?![\w\d]+:\/\/[\w\d.]+):[\d]+/.exec(t)){let e=/[\w\d]+:\/\/[\w\d.]+/.exec(t)[0].length;t=t.slice(0,e)+":8776"+t.slice(e)}const n=new r.Session(e),o=new r.Connection(n,t);return new s.Telekinesis(new Promise((t=>o.connect().then((()=>t(o.entrypoint))))),n,...i)}get(){}}e.Entrypoint=o,e.createEntrypoint=function(t,e="ws://localhost:8776",i,o,a=!0,...l){return n(this,void 0,void 0,(function*(){if(!/(?![\w\d]+:\/\/[\w\d.]+):[\d]+/.exec(e)){let t=/[\w\d]+:\/\/[\w\d.]+/.exec(e)[0].length;e=e.slice(0,t)+":8776"+e.slice(t)}const n=new r.Session(i),u=new r.Connection(n,e);yield u.connect();const h=new s.Telekinesis(t,n,...l);return h._channel=new r.Channel(n,o,a),h._channel.listen(),h._channel.telekinesis=h,yield h._channel.execute(),h._channel.route,h}))}},516:function(t,e,i){"use strict";var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{l(n.next(t))}catch(t){s(t)}}function a(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.PermissionError=e.blockArgEvaluation=e.injectFirstArg=e.Telekinesis=e.State=void 0;const r=i(26),s=i(988);class o{constructor(t,e,i,n,r,s){this.attributes=t||new Set,this.methods=e||new Map,this.pipeline=s||[],this.repr=i||"",this.doc=n,this.name=r,this._pendingChanges={},this._historyOffset=0,this._history=[]}toObject(t,e=!1){return t=t||new Set,{attributes:e&&this.attributes instanceof Map?Array.from(this.attributes.keys()).filter((e=>!t.has(e))).reduce(((t,e)=>(t[e]=this.attributes.get(e),t)),{}):Array.from(this.attributes.keys()).filter((e=>!t.has(e))),methods:Array.from(this.methods.keys()).filter((e=>!t.has(e))).reduce(((t,e)=>(t[e]=this.methods.get(e),t)),{}),pipeline:this.pipeline.map((t=>t)),repr:this.repr,doc:this.doc,name:this.name}}clone(){const t=o.fromObject(this.toObject(void 0,!0));return t._history=Array.from(this._history),t._historyOffset=this._historyOffset,t}static fromObject(t){return new o(t.attributes instanceof Array?new Set(t.attributes):t.attributes instanceof Set||t.attributes instanceof Map?t.attributes:Object.getOwnPropertyNames(t.attributes||{}).reduce(((e,i)=>(e.set(i,t.attributes[i]),e)),new Map),t.methods instanceof Map?t.methods:Object.getOwnPropertyNames(t.methods||{}).reduce(((e,i)=>(e.set(i,t.methods[i]),e)),new Map),t.repr,t.doc,t.name,t.pipeline)}getDiffs(t,e,i=!1){if(t<this._historyOffset&&t>=0)return[this._historyOffset+this._history.length,this.toObject(e,i)];const n={};for(let r in this._history.slice(t-this._historyOffset)){const s=this._history.slice(t-this._historyOffset)[r],o={};if(s.attributes){let t;t=i?Array.from(Object.entries(s.attributes[1])).filter((([t,i])=>!(e||new Set).has(t))):Array.from(Object.entries(s.attributes[1])).filter((([t,i])=>!(e||new Set).has(t)&&["c","d"].includes(i[0]))).map((([t,e])=>[t,e[0]])),t.length&&(o.attributes=[s.attributes[0],t.reduce(((t,[e,i])=>(t[e]=i,t)),{})])}if(s.methods){let t;t=Array.from(Object.entries(s.methods[1])).filter((([t,i])=>!(e||new Set).has(t))),t.length&&(o.methods=[s.methods[0],t.reduce(((t,[e,i])=>(t[e]=i,t)),{})])}s.repr&&(o.repr=s.repr),s.doc&&(o.doc=s.doc),n[(parseInt(r)+t+1).toString()]=o}return n.pipeline=this.pipeline,[0,n]}updateFromTarget(t){if(null!=t){if(t._isTelekinesisObject){const e=t._state.clone();this._historyOffset=1;for(let t of["attributes","methods","repr","doc","name"])this[t]=e[t];return this}const e={attributes:Object.getOwnPropertyNames(t).filter((t=>"_"!==t[0])).reduce(((e,i)=>{var n;const r=t[i];return void 0!==r&&"Object"===(null===(n=Object.getPrototypeOf(r))||void 0===n?void 0:n.constructor.name)?e.set(i,Object.entries(r).reduce(((t,[e,i])=>(t[e]=i,t)),{})):e.set(i,r),e}),new Map),methods:Object.getOwnPropertyNames(Object.getPrototypeOf(t)||{}).filter((t=>!["constructor","arguments","caller","callee","prototype"].includes(t)&&"_"!==t[0])).reduce(((e,i)=>(e.set(i,["(*args)",t[i].toString()]),e)),new Map),repr:t.toString&&t.toString()||"",doc:t.__doc__,name:t.__name__};if(t instanceof Function&&e.methods.set("__call__",["(*args)",t.toString()]),0==this._historyOffset){const t=o.fromObject(e);this._historyOffset=1;for(let i of Object.getOwnPropertyNames(e))this[i]=t[i];return this}const i={};return i[this._historyOffset+this._history.length+1]=Object.getOwnPropertyNames(e).map((t=>[t,o.calcDiff(this[t],e[t])])).reduce(((t,[e,i])=>(i&&(t[e]=i),t)),{}),Object.keys(i[this._historyOffset+this._history.length+1]).length?this.updateFromDiffs(0,i):this}}updateFromDiffs(t,e){const i=["attributes","methods","repr","doc"];if(t){let n;this._history=[],this._historyOffset=t,this._pendingChanges={},n=e.attributes&&!(e.attributes instanceof Map||e.attributes instanceof Set)||e.methods&&!(e.methods instanceof Map)?o.fromObject(e):e;for(const t of i)this[t]=n[t]}else{const t=this._historyOffset+this._history.length+1;if(Object.keys(e).includes(t.toString()))for(let i in Object.keys(e))if("pipeline"===Object.keys(e)[i])this.pipeline=e.pipeline;else{const n=e[(t+parseInt(i)).toString()];void 0!==n&&this._history.push(n);for(let t of Object.getOwnPropertyNames(n))this[t]=o.applyDiff(this[t],n[t])}else Object.assign(this._pendingChanges,Object.entries(e).filter((([t,e])=>"pipeline"!=t)).reduce(((t,[e,i])=>(t[e]=i,t)),{}))}Object.keys(e).includes("pipeline")}static calcDiff(t,e,i=10){var n,r;if(t!==e){if(i>0){if(t instanceof Map&&e instanceof Map){const n={};for(let r of t.keys())if(e.has(r)){const s=o.calcDiff(t.get(r),e.get(r),i-1);s&&(n[r]=s)}else n[r]=["d"];for(let i of e.keys())t.has(i)||(n[i]=["c",e.get(i)]);return Object.keys(n).length?["u",n]:void 0}if(t instanceof Array&&e instanceof Array&&t.length==e.length){for(let i in t)if(typeof t[i]!=typeof e[i]||t[i]!==e[i])return["r",e];return}if(void 0!==t&&"Object"===(null===(n=Object.getPrototypeOf(t))||void 0===n?void 0:n.constructor.name)&&void 0!==e&&"Object"===(null===(r=Object.getPrototypeOf(e))||void 0===r?void 0:r.constructor.name)){const n={};for(const r of Object.keys(t))if(Object.getOwnPropertyNames(e).includes(r)){const s=o.calcDiff(t[r],e[r],i-1);s&&(n[r]=s)}else n[r]=["d"];for(const i of Object.keys(e))Object.keys(t).includes(i)||(n[i]=["c",e[i]]);return Object.keys(n).length?["u",n]:void 0}}return["r",e]}}static applyDiff(t,e){var i;if(!e||0===Object.keys(e).length)return t;if("c"===e[0]||"r"===e[0])return e[1];if("u"===e[0]){if(t instanceof Map){const i=new Map(t);for(const[t,n]of Object.entries(e[1])){const e=n[0];["c","r"].includes(e)?i.set(t,n[1]):"r"==e?i.delete(t):"u"==e&&i.set(t,o.applyDiff(i.get(t),n))}return i}if(t instanceof Set){const i=new Set(t);for(const[t,n]of Object.entries(e))"c"===n?i.add(t):"d"===n&&i.delete(t);return i}if(void 0!==t&&"Object"===(null===(i=Object.getPrototypeOf(t))||void 0===i?void 0:i.constructor.name)){const i=Object.entries(t).reduce(((t,[i,n])=>("d"!==e[1][i]&&(t[i]=n),t)),{});for(const[t,n]of Object.entries(e[1])){const e=n[0];["c","r"].includes(e)?i[t]=n[1]:"u"===e&&(i[t]=o.applyDiff(i[t],n))}return i}}}}e.State=o;class a extends Function{constructor(t,e,i,n=!0,s,l){if(super(),this._target=t,this._session=e,this._mask=i&&(i instanceof Set?i:i.reduce(((t,e)=>(t.add(e),t)),new Set))||new Set,this._exposeTb=n,this._maxDelegationDepth=s,this._parent=l,this._state=new o,this._subscribers=new Set,this._lastUpdate=Date.now(),this._blockThen=!1,this._catchFn,this._isTelekinesisObject=!0,this._requests=new Map,this._proxy=new Proxy(this,{get(t,e){if("_"===e[0])return t[e];if("then"===e)return t._blockThen&&Date.now()-t._lastUpdate<300?new Promise((e=>e(t))):(e,i)=>{t.__execute().catch((e=>{t._catchFn?(t._catchFn(e),t._catchFn=void 0):i(e)})).then((i=>{e&&e(i&&i[0]),t._catchFn=void 0}))};if("catch"===e)return e=>(t._catchFn=e,t._proxy);let i=t._state.clone();i.pipeline.push(["get",e]);let n=new a(t._target,t._session,t._mask,t._exposeTb,t._maxDelegationDepth,t._proxy);return n._state=i,n},apply:(t,e,i)=>t._call(i)}),t instanceof r.Route){e.routes.has(t._hash)||e.routes.set(t._hash,{refcount:0,delegations:new Set,state:new o});const i=this._session.routes.get(t._hash);this._updateState(...i.state.getDiffs(0,void 0,!0)),void 0===l&&(i.refcount+=1)}else t instanceof Promise||this._parent||(this._clients=new Map,e.targets.set(t,(e.targets.get(t)||new Set).add(this._proxy)),this._state.updateFromTarget(t));return this._proxy}_getRootParent(){return void 0!==this._parent?this._parent:this}get _lastValue(){if(1===this._state.pipeline.length&&"get"===this._state.pipeline[0][0]&&this._state.attributes instanceof Map)return this._state.attributes.get(this._state.pipeline[0][1])}_updateState(t,e){void 0!==t&&this._state.updateFromDiffs(t,e);for(const t of Object.getOwnPropertyNames(this))"_"===t[0]||["prototype","arguments","caller","length","name"].includes(t)||delete this[t];for(const t of Array.from(this._state.methods.keys()).concat(Array.from(this._state.attributes.keys())))["length","name"].includes(t)||(this[t]=null);this._onUpdateCallback&&this._onUpdateCallback(this)}_delegate(t,e){var i,s;return n(this,void 0,void 0,(function*(){let n,o=this._maxDelegationDepth,a=!0,l=[];if(this._target instanceof r.Route){if(n=this._target.clone(),o=void 0,"*"===t)throw Error("Cannot delegate remote Route to public '*'")}else(void 0===this._channel||(null===(i=this._channel)||void 0===i?void 0:i.isPublic)&&"*"===t)&&(this._channel?this._channel.isPublic=!0:(this._channel=yield new r.Channel(this._session,void 0,"*"===t),this._channel.telekinesis=this),this._channel.listen(),l.push(this._channel.headerBuffer.pop())),this._channel.isPublic&&(a=!1),n=yield this._channel.route;return a&&(yield this._session.extendRoute(n,t instanceof Array?t[0]:t,o),this._session.routes.has(n._hash)&&this._session.routes.get(n._hash).delegations.add(t instanceof Array?t:[t,null])),n._parentChannel=e||this._channel,null===(s=n._parentChannel)||void 0===s||s.headerBuffer.push(...l),n}))}_subscribe(t){return this._onUpdateCallback=t,this._subscription=new a((t=>{const e=this._state.pipeline;this._updateState(...t._state.getDiffs(0,void 0,!0)),this._state.pipeline=e}),this._session,void 0,this._exposeTb,this._maxDelegationDepth),this._state.pipeline.push(["subscribe",this._subscription]),this}_handleRequest(t,e,i){var s,o,a,l;return n(this,void 0,void 0,(function*(){let n,u;try{if(this._clients&&e.caller&&!this._clients.has(null===(s=e.caller)||void 0===s?void 0:s.session.join())&&(this._clients.set(e.caller.session.join(),{lastState:null,cacheAttributes:null}),this._clients.delete([e.caller.session[0],null].join())),void 0!==i.close&&e.caller){null===(o=this._clients)||void 0===o||o.delete(e.caller.session.join());for(const t of i.close)this._clients&&!this._clients.has(t.join())&&(this._clients.set(t.join(),{lastState:null,cacheAttributes:null}),null!==t[1]&&this._clients.delete([t[0],null].join()));0==(null===(a=this._clients)||void 0===a?void 0:a.size)&&!1===(null===(l=this._channel)||void 0===l?void 0:l.isPublic)&&(yield this._close())}else if(void 0!==i.ping&&e.caller)yield t.send(e.caller,{repr:this._state.repr});else if(void 0!==i.pipeline&&e.caller){let s={metadata:e,payload:i,channel:t};this._requests.set(e.caller,s),i.reply_to&&(u=r.Route.fromObject(i.reply_to),yield u.validateTokenChain(yield this._session.sessionKey.publicSerial(!1)),e.replyTo=u),n=yield this._decode(i.pipeline,e.caller.session[0]);let[o,a]=yield this.__execute(e,n,!0);yield this._respondRequest(e.caller,o,a,!1)}}catch(t){let n;console.log(`Telekinesis request error with payload ${JSON.stringify(i,void 0,2)}, ${t.message}`+this._exposeTb?"\n"+t.stack:""),this._state.pipeline=[],n=t instanceof Error?{error:t.name+" "+t.message+"\n"+(this._exposeTb?t.stack:""),error_type:t.name+" "+t.message}:{error:t+"",error_type:"Error"},e.caller&&(yield this._respondRequest(e.caller,n,void 0,!0))}}))}_respondRequest(t,e,i,s=!1){return n(this,void 0,void 0,(function*(){if(this._requests.has(t)){let{metadata:n,payload:o,channel:l}=this._requests.get(t),u=n.replyTo;if(this._requests.delete(n.caller),s)try{if(void 0!==u){const t=new r.Channel(this._session);try{yield t.send(u,e)}catch(t){}finally{yield t.close()}}else yield l.send(n.caller,e)}catch(t){}else if(e instanceof a&&e._target instanceof r.Route&&(e._target.session.toString()!==[yield this._session.sessionKey.publicSerial(!1),this._session.instanceId].toString()||!this._session.channels.has(e._target.channel))&&this._onSameNetwork(e._session))yield e._forward(e._state.pipeline,u||n.caller,(yield e._session.sessionKey.publicSerial(!1))!=(yield this._session.sessionKey.publicSerial(!1))?this._session:void 0,{root_parent:u?o.root_parent:[this,n.caller.session]});else if(void 0!==u){const t=new r.Channel(this._session);try{yield t.send(u,{return:yield this._encode(e,u.session,t,i),root_parent:o.root_parent})}catch(t){}finally{yield t.close()}}else{const t=yield this._encode(this,n.caller.session,l);yield l.send(n.caller,{return:yield this._encode(e,n.caller.session,void 0,i),root_parent:e===this||e===this._target&&e===this._proxy?null:t}).catch((t=>null))}}}))}_call(t,e){let i=this._state.clone();i.pipeline.push(["call",[t,e||{}]]);let n=new a(this._target,this._session,this._mask,this._exposeTb,this._maxDelegationDepth,this._proxy);return n._state.pipeline=i.pipeline,n}_execute(){return n(this,void 0,void 0,(function*(){return(yield this.__execute())[0]}))}__execute(t,e,i=!1){var s,u;return n(this,void 0,void 0,(function*(){if(this._target instanceof Promise&&(this._target=yield this._target,this._target instanceof r.Route?void 0===this._parent&&(this._session.routes.has(this._target._hash)||this._session.routes.set(this._target._hash,{refcount:0,delegations:new Set,state:new o}),this._session.routes.get(this._target._hash).refcount+=1):this._session.targets.set(this._target,(this._session.targets.get(this._target)||new Set).add(this._proxy))),e=e||[],e=this._state.pipeline.concat(e),this._state.pipeline=[],void 0===t&&(t=new r.RequestMetadata(this._session)),this._target instanceof r.Route)return[yield this._forward(e),void 0];function n(e){var i,n;return void 0!==(null==e?void 0:e._blockThen)&&(null==e?void 0:e._lastUpdate)&&(null===(n=null===(i=null==e?void 0:e._state)||void 0===i?void 0:i.pipeline)||void 0===n?void 0:n.length)?new Promise((i=>e._execute(t).then((t=>i(t[0]))))):e}let h=this._target,f=this._prevTarget||h,c=!1,d=this._session.targets.get(this._target)||new Set;for(let o in e){let p=!1;if(i&&h instanceof a&&h._target instanceof r.Route&&(h._target.session.toString()!==[yield this._session.sessionKey.publicSerial(!1),this._session.instanceId].toString()||!this._session.channels.has(h._target.channel))){const t=h._state;h=new a(h._target,h._session,h._mask,h._exposeTb,h._maxDelegationDepth,h._parent),h._state=t.clone(),h._state.pipeline.push(...e.slice(parseInt(o))),this._onSameNetwork(h._session)?h._blockThen=!0:h=yield h;break}let y=e[o][0];if("get"===y){let t=e[o][1];if("__getitem__"!==t&&"_"===t[0]||this._mask.has(t))throw new l("Private attributes and methods (those starting with _) cannot be accessed remotely");if(f=h,h="__getitem__"===t?t=>{if("_"===t[0]||this._mask.has(t))throw new l("Private attributes and methods (those starting with _) cannot be accessed remotely");return[f[t],f]}:h[t],void 0===h)throw ReferenceError(`Attribute ${t} not found`);h instanceof Function&&h.bind(f)}else if("call"===y){let i=e[o][1][0],r=[];if(!0===h._tk_block_arg_evaluation)r=i;else for(let t in i)r[t]=n(i[t]),r[t]instanceof Promise&&(r[t]=yield r[t]);!0===h._tk_inject_first&&(t.pipeline=e.slice(Number(o)+1),p=!0,r=[t,...r]);try{h=h.call(f,...r)}catch(t){try{h=new h(...r)}catch(e){throw t}}(h instanceof Promise||h&&"Promise"===(null===(s=Object.getPrototypeOf(h))||void 0===s?void 0:s.constructor.name))&&(h=yield h),!p||t.pipeline&&t.pipeline.length||(c=!0)}else if("subscribe"===y){const i=e[o][1],n=i._target;if(t&&t.caller&&(yield n.validateTokenChain(t.caller.session[0]))){const t=a._reuse(h,this._session,this._mask,this._exposeTb,this._maxDelegationDepth);t._clients&&!t._clients.has(n.session.join())&&(t._clients.set(n.session.join(),{lastState:null,cacheAttributes:null}),t._clients.delete([n.session[0],null].join())),(null===(u=t._clients)||void 0===u?void 0:u.get(n.session.join())).cacheAttributes=!0,t._subscribers.add(i)}}if(h instanceof a&&!(i&&h._target instanceof r.Route)&&(h=(yield h.__execute())[0]),d=new Set([...d,...this._session.targets.get(h)||[]]),c)break}for(const t of d){t._state.updateFromTarget(t._target),t._updateState();const e=Array.from(t._subscribers);e.length&&e.map((e=>e(t)._execute()))}return h!==this._target||void 0!==this._target&&null!==this._target?(h instanceof a&&!h._blockThen&&(h._blockThen=!0),[h,f]):(this._lastUpdate=Date.now(),this._blockThen=!0,[this._proxy,f])}))}_timeout(t){return Promise.race([new Promise((e=>setTimeout((()=>{this._catchFn&&this._catchFn("Timeout"),e()}),1e3*t))),this._execute().catch(this._catchFn)])}_sendRequest(t,e){var i;return n(this,void 0,void 0,(function*(){try{yield t.send(this._target,e)}catch(t){throw t}if(void 0===e.reply_to){let[e,n]=yield t.recv();if(n.root_parent){const t=this._getRootParent(),[r,s]=(yield t._decode(n.root_parent,null===(i=e.caller)||void 0===i?void 0:i.session[0]))._state.getDiffs(0,void 0,!0);t._updateState(r,s)}if(Object.getOwnPropertyNames(n).includes("error"))throw Error(n.error);if(Object.getOwnPropertyNames(n).includes("return"))return yield this._decode(n.return,this._target.session[0])}}))}_close(){var t,e,i;return n(this,void 0,void 0,(function*(){try{if(this._target instanceof r.Route){const t=this._session.routes.get(this._target._hash);if(void 0!==t.refcount&&(t.refcount-=0,t.refcount<=0)){const e=new r.Channel(this._session);yield e.send(this._target,{close:Array.from(t.delegations)||[]})}}else null===(t=this._session.targets.get(this._target))||void 0===t||t.delete(this),0===(null===(e=this._session.targets.get(this._target))||void 0===e?void 0:e.size)&&this._session.targets.delete(this._target),yield null===(i=this._channel)||void 0===i?void 0:i.close()}catch(t){console.error(t)}}))}_forward(t,e,i,s){return n(this,void 0,void 0,(function*(){let n=new r.Channel(this._session);try{if(void 0!==e&&(void 0!==i&&(yield i.extendRoute(e,yield this._session.sessionKey.publicSerial(!1))),yield this._session.extendRoute(e,this._target.session[0])),s)for(let[t,e]of Object.entries(s))e instanceof Array&&2==e.length&&e[0]instanceof a&&(s[t]=yield e[0]._encode(e[0]._proxy,e[1],n));return yield this._sendRequest(n,Object.assign({reply_to:null==e?void 0:e.toObject(),pipeline:yield this._encode(t,this._target.session,n)},s))}catch(t){if(void 0===e)throw t}finally{yield n.close()}}))}_encode(t,e,i,s,o,l=!1,h=!1){var f,c,d,p,y,g,_,b,w,v,m,x,S,O,k;return n(this,void 0,void 0,(function*(){let n=0;if(void 0===o)o=new Map;else{if(o.has(t))return o.get(t)[0].toString();n=o.size}void 0===e&&(e=[yield this._session.sessionKey.publicSerial(!1),this._session.instanceId]);let E=[n,["placeholder",null]];if(o.set(t,E),["number","boolean","string"].includes(typeof t)||null==t)E[1]=[{number:Number.isInteger(t)?"int":"float",string:"str",boolean:"bool",object:"NoneType",undefined:"NoneType"}[typeof t],t];else if(void 0!==t&&"Uint8Array"===(null===(f=Object.getPrototypeOf(t))||void 0===f?void 0:f.constructor.name)||t instanceof Uint8Array)E[1]=["bytes",t];else if(void 0!==t&&"Array"===(null===(c=Object.getPrototypeOf(t))||void 0===c?void 0:c.constructor.name)&&u(t))E[1]=["raw_list",t];else if(void 0!==t&&"Object"===(null===(d=Object.getPrototypeOf(t))||void 0===d?void 0:d.constructor.name)&&u(t))E[1]=["raw_dict",t];else if(void 0===t||"Array"!==(null===(p=Object.getPrototypeOf(t))||void 0===p?void 0:p.constructor.name)&&"Set"!==(null===(y=Object.getPrototypeOf(t))||void 0===y?void 0:y.constructor.name))if(void 0!==t&&"Object"===(null===(_=Object.getPrototypeOf(t))||void 0===_?void 0:_.constructor.name)){let n=[];for(let r in t)n.push([yield this._encode(r,e,i,void 0,o,l),yield this._encode(t[r],e,i,void 0,o,l)]);E[1]=["dict",n]}else if(void 0!==t&&t instanceof r.Route)E[1]=["route",t.toObject()];else{let n;n=!0!==t._isTelekinesisObject||t._target instanceof r.Route&&!h&&!this._onSameNetwork(t._session)?a._reuse(t,this._session,this._mask,this._exposeTb,this._maxDelegationDepth,void 0):t,t._target instanceof r.Route||(!1===(null===(b=n._clients)||void 0===b?void 0:b.has(e.join()))&&(null===(w=n._clients)||void 0===w||w.set(e.join(),{lastState:null,cacheAttributes:null})),null!==e[1]&&(null===(v=n._clients)||void 0===v||v.delete([e[0],null].join())),s&&(n._prevTarget=s));let u=yield n._delegate(e[0],i||this._channel),f=e!==u.session?n._state.getDiffs((null===(x=null===(m=n._clients)||void 0===m?void 0:m.get(e.join()))||void 0===x?void 0:x.lastState)||0,this._mask,!l&&(null===(O=null===(S=n._clients)||void 0===S?void 0:S.get(e.join()))||void 0===O?void 0:O.cacheAttributes)):[0,{pipeline:n._state.pipeline}];E[1]=["obj",[u.toObject(),yield this._encode(f,e,i,void 0,o,!0)]],(null===(k=n._clients)||void 0===k?void 0:k.has(e.join()))&&(n._clients.get(e.join()).lastState=n._state._historyOffset+n._state._history.length)}else{let n=[],r=t instanceof Array?t:Array.from(t.values());for(let t in r)n[t]=yield this._encode(r[t],e,i,void 0,o,l);E[1]=["Array"===(null===(g=Object.getPrototypeOf(t))||void 0===g?void 0:g.constructor.name)?"list":"set",n]}return o.delete(t),o.set(t,E),0===n?Array.from(o.values()).reduce(((t,e)=>(t[e[0]]=e[1],t)),{}):n.toString()}))}_decode(t,e,i,s=new Map){var l,u,h;return n(this,void 0,void 0,(function*(){let n;if(void 0===i&&(i="0"),void 0!==i){if(s.has(i))return s.get(i);let f=t[i][0],c=t[i][1];if(["int","float","str","bool","NoneType","raw_list","raw_dict"].includes(f))n=c;else if("bytes"===f)n=c.buffer;else if(["list","tuple","set"].includes(f)){let r=Array(c.length);s.set(i,r);for(let i in c)r[i]=yield this._decode(t,e,c[i],s);n="set"===f?r.reduce(((t,e)=>(t.add(e),t)),new Set):r,s.set(i,n)}else if(["range","slice"].includes(f)){let t=Math.ceil((c[1]-c[0])/c[2]);n=t<=0?[]:new Array(t).fill(0).map(((t,e)=>c[0]+c[2]*e))}else if("dict"===f){n={},s.set(i,n);for(let[i,r]of c)n[yield this._decode(t,e,i,s)]=yield this._decode(t,e,r,s);s.set(i,n)}else if("route"===f)n=r.Route.fromObject(c);else{const f=r.Route.fromObject(c[0]),[d,p]=yield this._decode(t,e,c[1],s);if(JSON.stringify(f.session)==JSON.stringify([yield this._session.sessionKey.publicSerial(!1),this._session.instanceId])&&this._session.channels.has(f.channel)&&e){let t=this._session.channels.get(f.channel);(yield null==t?void 0:t.validateTokenChain(e,f.tokens))&&((null==p?void 0:p.pipeline)?(n=new a(null===(l=null==t?void 0:t.telekinesis)||void 0===l?void 0:l._target,this._session,this._mask,this._exposeTb,this._maxDelegationDepth),n._state=null===(u=null==t?void 0:t.telekinesis)||void 0===u?void 0:u._state.clone(),n._state.updateFromDiffs(d,p),n._state.pipeline=p.pipeline,n._target instanceof r.Route||(n=yield n)):n=null===(h=null==t?void 0:t.telekinesis)||void 0===h?void 0:h._target)}else{this._session.routes.has(f._hash)||this._session.routes.set(f._hash,{refcount:0,delegations:new Set,state:new o});const t=this._session.routes.get(f._hash);t.state.updateFromDiffs(d,p),this._parent&&"0"===i?(this._target=f,t.refcount+=1,this._updateState(...t.state.getDiffs(0,void 0,!0)),this._parent=void 0,n=this._proxy):this._target instanceof r.Route&&JSON.stringify(this._target.toObject())===JSON.stringify(f.toObject())?(this._updateState(...t.state.getDiffs(0,void 0,!0)),n=this._proxy):n=new a(f,this._session,this._mask,this._exposeTb,this._maxDelegationDepth)}}return!0===(null==n?void 0:n._isTelekinesisObject)&&(n._lastUpdate=Date.now(),n._blockThen=!0),s.set(i,n),n}}))}_onSameNetwork(t){for(let e of t.connections)for(let t of this._session.connections)if([...e.brokerPeers||[],e.brokerId||""].filter((e=>[...t.brokerPeers||[],t.brokerId||""].includes(e))).length)return!0;return!1}get __signature__(){return this._state.pipeline.length?(this._state.methods.get(this._state.pipeline[this._state.pipeline.length-1][1])||[void 0])[0]:(this._state.methods.get("__call__")||[void 0])[0]}get __doc__(){return this._state.pipeline.length?(this._state.methods.get(this._state.pipeline[this._state.pipeline.length-1][1])||[null,void 0])[1]:(this._state.doc||"")+"\n"+(this._state.methods.get("__call__")||[null,""])[1]}static _reuse(t,e,i,n=!0,r,o=!0,l){const u={target:t,session:e,mask:new Set(i),exposeTb:n,maxDelegationDepth:r,compileSignatures:o};return Array.from(e.targets.get(t)||[]).reduce(((t,e)=>t||Object.entries(u).reduce(((t,i)=>t&&(e["_"+i[0]]instanceof Set?(0,s.eqSet)(e["_"+i[0]],i[1]):e["_"+i[0]]===i[1])),!0)&&e),void 0)||new a(t,e,i,n,r,l)}}e.Telekinesis=a,e.injectFirstArg=function(t){return t._tk_inject_first=!0,t},e.blockArgEvaluation=function(t){return t._tk_block_arg_evaluation=!0,t};class l extends Error{constructor(t){super(t),this.name="PermissionError"}}function u(t,e=0){var i,n,r;return!(e>=300)&&(!!(["number","boolean","string"].includes(typeof t)||null==t||void 0!==t&&"Uint8Array"===(null===(i=Object.getPrototypeOf(t))||void 0===i?void 0:i.constructor.name))||(void 0!==t&&"Array"===(null===(n=Object.getPrototypeOf(t))||void 0===n?void 0:n.constructor.name)?t.reduce(((t,i)=>t&&u(i,e+1)),!0):void 0!==t&&"Object"===(null===(r=Object.getPrototypeOf(t))||void 0===r?void 0:r.constructor.name)&&Array.from(Object.values(t)).reduce(((t,i)=>t&&u(i,e+1)),!0)))}e.PermissionError=l},988:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.eqSet=e.bytesToInt=e.intToBytes=e.b64decode=e.b64encode=void 0;const n="undefined"!=typeof btoa?btoa:i(706),r="undefined"!=typeof atob?atob:i(892);e.b64encode=function(t){return n(String.fromCharCode.apply(null,t))},e.b64decode=function(t){return new Uint8Array(r(t).split("").map((function(t){return t.charCodeAt(0)})))},e.intToBytes=function(t,e){return new Uint8Array(e).map(((i,n)=>t/Math.pow(256,e-n-1)))},e.bytesToInt=function(t){return Array.from(t).reduce(((e,i,n)=>e+i*Math.pow(256,t.length-n-1)),0)},e.eqSet=function(t,e){if(t.size!==e.size)return!1;for(var i of t)if(!e.has(i))return!1;return!0}},892:(t,e,i)=>{t=i.nmd(t),function(e){"use strict";var i,n="function"==typeof(i=e.atob)?i:"function"==typeof Buffer?function(t){return new Buffer(t,"base64").toString("binary")}:"object"==typeof e.base64js?function(t){var i=e.base64js.b64ToByteArray(t);return Array.prototype.map.call(i,(function(t){return String.fromCharCode(t)})).join("")}:function(){throw new Error("You're probably in an old browser or an iOS webworker. It might help to include beatgammit's base64-js.")};e.atob=n,t&&t.exports&&(t.exports=n)}(window)},121:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BSONError:()=>x,BSONRegExp:()=>xt,BSONSymbol:()=>St,BSONTypeError:()=>S,BSON_BINARY_SUBTYPE_BYTE_ARRAY:()=>pe,BSON_BINARY_SUBTYPE_COLUMN:()=>we,BSON_BINARY_SUBTYPE_DEFAULT:()=>ce,BSON_BINARY_SUBTYPE_ENCRYPTED:()=>be,BSON_BINARY_SUBTYPE_FUNCTION:()=>de,BSON_BINARY_SUBTYPE_MD5:()=>_e,BSON_BINARY_SUBTYPE_USER_DEFINED:()=>ve,BSON_BINARY_SUBTYPE_UUID:()=>ye,BSON_BINARY_SUBTYPE_UUID_NEW:()=>ge,BSON_DATA_ARRAY:()=>Vt,BSON_DATA_BINARY:()=>qt,BSON_DATA_BOOLEAN:()=>Gt,BSON_DATA_CODE:()=>ne,BSON_DATA_CODE_W_SCOPE:()=>se,BSON_DATA_DATE:()=>Qt,BSON_DATA_DBPOINTER:()=>ie,BSON_DATA_DECIMAL128:()=>ue,BSON_DATA_INT:()=>oe,BSON_DATA_LONG:()=>le,BSON_DATA_MAX_KEY:()=>fe,BSON_DATA_MIN_KEY:()=>he,BSON_DATA_NULL:()=>te,BSON_DATA_NUMBER:()=>Yt,BSON_DATA_OBJECT:()=>Ht,BSON_DATA_OID:()=>Wt,BSON_DATA_REGEXP:()=>ee,BSON_DATA_STRING:()=>Jt,BSON_DATA_SYMBOL:()=>re,BSON_DATA_TIMESTAMP:()=>ae,BSON_DATA_UNDEFINED:()=>Xt,BSON_INT32_MAX:()=>Mt,BSON_INT32_MIN:()=>$t,BSON_INT64_MAX:()=>Ct,BSON_INT64_MIN:()=>Kt,Binary:()=>Z,Code:()=>Y,DBRef:()=>H,Decimal128:()=>dt,Double:()=>pt,EJSON:()=>Dt,Int32:()=>yt,Long:()=>tt,LongWithoutOverridesClass:()=>Ot,Map:()=>Lt,MaxKey:()=>gt,MinKey:()=>_t,ObjectID:()=>mt,ObjectId:()=>mt,Timestamp:()=>kt,UUID:()=>F,calculateObjectSize:()=>ui,default:()=>fi,deserialize:()=>li,deserializeStream:()=>hi,serialize:()=>oi,serializeWithBufferAndIndex:()=>ai,setInternalBufferSize:()=>si});for(var n=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=o.length;a<l;++a)n[a]=o[a],r[o.charCodeAt(a)]=a;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function h(t,e,i){for(var r,s,o=[],a=e;a<i;a+=3)r=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(n[(s=r)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63;var f,c,d=function(t){var e,i,n=u(t),o=n[0],a=n[1],l=new s(function(t,e,i){return 3*(e+i)/4-i}(0,o,a)),h=0,f=a>0?o-4:o;for(i=0;i<f;i+=4)e=r[t.charCodeAt(i)]<<18|r[t.charCodeAt(i+1)]<<12|r[t.charCodeAt(i+2)]<<6|r[t.charCodeAt(i+3)],l[h++]=e>>16&255,l[h++]=e>>8&255,l[h++]=255&e;return 2===a&&(e=r[t.charCodeAt(i)]<<2|r[t.charCodeAt(i+1)]>>4,l[h++]=255&e),1===a&&(e=r[t.charCodeAt(i)]<<10|r[t.charCodeAt(i+1)]<<4|r[t.charCodeAt(i+2)]>>2,l[h++]=e>>8&255,l[h++]=255&e),l},p=function(t){for(var e,i=t.length,r=i%3,s=[],o=16383,a=0,l=i-r;a<l;a+=o)s.push(h(t,a,a+o>l?l:a+o));return 1===r?(e=t[i-1],s.push(n[e>>2]+n[e<<4&63]+"==")):2===r&&(e=(t[i-2]<<8)+t[i-1],s.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"=")),s.join("")},y=function(t,e,i,n,r){var s,o,a=8*r-n-1,l=(1<<a)-1,u=l>>1,h=-7,f=i?r-1:0,c=i?-1:1,d=t[e+f];for(f+=c,s=d&(1<<-h)-1,d>>=-h,h+=a;h>0;s=256*s+t[e+f],f+=c,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=256*o+t[e+f],f+=c,h-=8);if(0===s)s=1-u;else{if(s===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),s-=u}return(d?-1:1)*o*Math.pow(2,s-n)},g=function(t,e,i,n,r,s){var o,a,l,u=8*s-r-1,h=(1<<u)-1,f=h>>1,c=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:s-1,p=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),(e+=o+f>=1?c/l:c*Math.pow(2,1-f))*l>=2&&(o++,l/=2),o+f>=h?(a=0,o=h):o+f>=1?(a=(e*l-1)*Math.pow(2,r),o+=f):(a=e*Math.pow(2,f-1)*Math.pow(2,r),o=0));r>=8;t[i+d]=255&a,d+=p,a/=256,r-=8);for(o=o<<r|a,u+=r;u>0;t[i+d]=255&o,d+=p,o/=256,u-=8);t[i+d-p]|=128*y},_=(f=function(t,e){var i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=s,e.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},e.INSPECT_MAX_BYTES=50;var n=2147483647;function r(t){if(t>n)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,s.prototype),e}function s(t,e,i){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return o(t,e,i)}function o(t,e,i){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!s.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var i=0|c(t,e),n=r(i),o=n.write(t,e);return o!==i&&(n=n.slice(0,o)),n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(K(t,Uint8Array)){var e=new Uint8Array(t);return h(e.buffer,e.byteOffset,e.byteLength)}return u(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(t));if(K(t,ArrayBuffer)||t&&K(t.buffer,ArrayBuffer))return h(t,e,i);if("undefined"!=typeof SharedArrayBuffer&&(K(t,SharedArrayBuffer)||t&&K(t.buffer,SharedArrayBuffer)))return h(t,e,i);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return s.from(n,e,i);var o=function(t){if(s.isBuffer(t)){var e=0|f(t.length),i=r(e);return 0===i.length||t.copy(i,0,0,e),i}return void 0!==t.length?"number"!=typeof t.length||F(t.length)?r(0):u(t):"Buffer"===t.type&&Array.isArray(t.data)?u(t.data):void 0}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+babelHelpers.typeof(t))}function a(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return a(t),r(t<0?0:0|f(t))}function u(t){for(var e=t.length<0?0:0|f(t.length),i=r(e),n=0;n<e;n+=1)i[n]=255&t[n];return i}function h(t,e,i){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(i||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===e&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,e):new Uint8Array(t,e,i),Object.setPrototypeOf(n,s.prototype),n}function f(t){if(t>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|t}function c(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||K(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+babelHelpers.typeof(t));var i=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===i)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return M(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return $(t).length;default:if(r)return n?-1:M(t).length;e=(""+e).toLowerCase(),r=!0}}function _(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return U(this,e,i);case"utf8":case"utf-8":return A(this,e,i);case"ascii":return B(this,e,i);case"latin1":case"binary":return T(this,e,i);case"base64":return E(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function b(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function w(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),F(i=+i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=s.from(e,n)),s.isBuffer(e))return 0===e.length?-1:v(t,e,i,n,r);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):v(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function v(t,e,i,n,r){var s,o=1,a=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,a/=2,l/=2,i/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(r){var h=-1;for(s=i;s<a;s++)if(u(t,s)===u(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*o}else-1!==h&&(s-=s-h),h=-1}else for(i+l>a&&(i=a-l),s=i;s>=0;s--){for(var f=!0,c=0;c<l;c++)if(u(t,s+c)!==u(e,c)){f=!1;break}if(f)return s}return-1}function m(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n))>r&&(n=r):n=r;var s=e.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a=parseInt(e.substr(2*o,2),16);if(F(a))return o;t[i+o]=a}return o}function x(t,e,i,n){return C(M(e,t.length-i),t,i,n)}function S(t,e,i,n){return C(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,n)}function O(t,e,i,n){return C($(e),t,i,n)}function k(t,e,i,n){return C(function(t,e){for(var i,n,r,s=[],o=0;o<t.length&&!((e-=2)<0);++o)n=(i=t.charCodeAt(o))>>8,r=i%256,s.push(r),s.push(n);return s}(e,t.length-i),t,i,n)}function E(t,e,i){return 0===e&&i===t.length?p(t):p(t.slice(e,i))}function A(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var s,o,a,l,u=t[r],h=null,f=u>239?4:u>223?3:u>191?2:1;if(r+f<=i)switch(f){case 1:u<128&&(h=u);break;case 2:128==(192&(s=t[r+1]))&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=t[r+1],o=t[r+2],128==(192&s)&&128==(192&o)&&(l=(15&u)<<12|(63&s)<<6|63&o)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=t[r+1],o=t[r+2],a=t[r+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(l=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&l<1114112&&(h=l)}null===h?(h=65533,f=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),r+=f}return function(t){var e=t.length;if(e<=N)return String.fromCharCode.apply(String,t);for(var i="",n=0;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=N));return i}(n)}e.kMaxLength=n,s.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(t,e,i){return o(t,e,i)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(t,e,i){return function(t,e,i){return a(t),t<=0?r(t):void 0!==e?"string"==typeof i?r(t).fill(e,i):r(t).fill(e):r(t)}(t,e,i)},s.allocUnsafe=function(t){return l(t)},s.allocUnsafeSlow=function(t){return l(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(K(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),K(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var i=t.length,n=e.length,r=0,o=Math.min(i,n);r<o;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=s.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var o=t[i];if(K(o,Uint8Array))r+o.length>n.length?s.from(o).copy(n,r):Uint8Array.prototype.set.call(n,o,r);else{if(!s.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r)}r+=o.length}return n},s.byteLength=c,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)b(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},s.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?A(this,0,t):_.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(t+=" ... "),"<Buffer "+t+">"},i&&(s.prototype[i]=s.prototype.inspect),s.prototype.compare=function(t,e,i,n,r){if(K(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+babelHelpers.typeof(t));if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(this===t)return 0;for(var o=(r>>>=0)-(n>>>=0),a=(i>>>=0)-(e>>>=0),l=Math.min(o,a),u=this.slice(n,r),h=t.slice(e,i),f=0;f<l;++f)if(u[f]!==h[f]){o=u[f],a=h[f];break}return o<a?-1:a<o?1:0},s.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},s.prototype.indexOf=function(t,e,i){return w(this,t,e,i,!0)},s.prototype.lastIndexOf=function(t,e,i){return w(this,t,e,i,!1)},s.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(i)?(i>>>=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return m(this,t,e,i);case"utf8":case"utf-8":return x(this,t,e,i);case"ascii":case"latin1":case"binary":return S(this,t,e,i);case"base64":return O(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,i);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var N=4096;function B(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function T(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function U(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",s=e;s<i;++s)r+=Z[t[s]];return r}function j(t,e,i){for(var n=t.slice(e,i),r="",s=0;s<n.length-1;s+=2)r+=String.fromCharCode(n[s]+256*n[s+1]);return r}function I(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,i,n,r,o){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function D(t,e,i,n,r,s){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function L(t,e,i,n,r){return e=+e,i>>>=0,r||D(t,0,i,4),g(t,e,i,n,23,4),i+4}function P(t,e,i,n,r){return e=+e,i>>>=0,r||D(t,0,i,8),g(t,e,i,n,52,8),i+8}s.prototype.slice=function(t,e){var i=this.length;(t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUintLE=s.prototype.readUIntLE=function(t,e,i){t>>>=0,e>>>=0,i||I(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n},s.prototype.readUintBE=s.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||I(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},s.prototype.readUint8=s.prototype.readUInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),this[t]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,i){t>>>=0,e>>>=0,i||I(t,e,this.length);for(var n=this[t],r=1,s=0;++s<e&&(r*=256);)n+=this[t+s]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},s.prototype.readIntBE=function(t,e,i){t>>>=0,e>>>=0,i||I(t,e,this.length);for(var n=e,r=1,s=this[t+--n];n>0&&(r*=256);)s+=this[t+--n]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},s.prototype.readInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||I(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},s.prototype.readInt16BE=function(t,e){t>>>=0,e||I(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return t>>>=0,e||I(t,4,this.length),y(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||I(t,4,this.length),y(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||I(t,8,this.length),y(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||I(t,8,this.length),y(this,t,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(t,e,i,n){t=+t,e>>>=0,i>>>=0,n||R(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,s=0;for(this[e]=255&t;++s<i&&(r*=256);)this[e+s]=t/r&255;return e+i},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(t,e,i,n){t=+t,e>>>=0,i>>>=0,n||R(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,s=1;for(this[e+r]=255&t;--r>=0&&(s*=256);)this[e+r]=t/s&255;return e+i},s.prototype.writeUint8=s.prototype.writeUInt8=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e>>>=0,!n){var r=Math.pow(2,8*i-1);R(this,t,e,i,r-1,-r)}var s=0,o=1,a=0;for(this[e]=255&t;++s<i&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+i},s.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e>>>=0,!n){var r=Math.pow(2,8*i-1);R(this,t,e,i,r-1,-r)}var s=i-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o>>0)-a&255;return e+i},s.prototype.writeInt8=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,i){return t=+t,e>>>=0,i||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeFloatLE=function(t,e,i){return L(this,t,e,!0,i)},s.prototype.writeFloatBE=function(t,e,i){return L(this,t,e,!1,i)},s.prototype.writeDoubleLE=function(t,e,i){return P(this,t,e,!0,i)},s.prototype.writeDoubleBE=function(t,e,i){return P(this,t,e,!1,i)},s.prototype.copy=function(t,e,i,n){if(!s.isBuffer(t))throw new TypeError("argument should be a Buffer");if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r=n-i;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,i,n):Uint8Array.prototype.set.call(t,this.subarray(i,n),e),r},s.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var r=t.charCodeAt(0);("utf8"===n&&r<128||"latin1"===n)&&(t=r)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;var o;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(o=e;o<i;++o)this[o]=t;else{var a=s.isBuffer(t)?t:s.from(t,n),l=a.length;if(0===l)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<i-e;++o)this[o+e]=a[o%l]}return this};var z=/[^+/0-9A-Za-z-_]/g;function M(t,e){var i;e=e||1/0;for(var n=t.length,r=null,s=[],o=0;o<n;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&s.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&s.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;s.push(i)}else if(i<2048){if((e-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function $(t){return d(function(t){if((t=(t=t.split("=")[0]).trim().replace(z,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function C(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}function K(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function F(t){return t!=t}var Z=function(){for(var t="0123456789abcdef",e=new Array(256),i=0;i<16;++i)for(var n=16*i,r=0;r<16;++r)e[n+r]=t[i]+t[r];return e}()},f(c={exports:{}},c.exports),c.exports),b=_.Buffer;_.SlowBuffer,_.INSPECT_MAX_BYTES,_.kMaxLength;var w=function(t,e){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},w(t,e)};function v(t,e){function i(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var m=function(){return m=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},m.apply(this,arguments)},x=function(t){function e(i){var n=t.call(this,i)||this;return Object.setPrototypeOf(n,e.prototype),n}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"BSONError"},enumerable:!1,configurable:!0}),e}(Error),S=function(t){function e(i){var n=t.call(this,i)||this;return Object.setPrototypeOf(n,e.prototype),n}return v(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return"BSONTypeError"},enumerable:!1,configurable:!0}),e}(TypeError);function O(t){return t&&t.Math==Math&&t}function k(){return O("object"==typeof globalThis&&globalThis)||O("object"==typeof window&&window)||O("object"==typeof self&&self)||O("object"==typeof i.g&&i.g)||Function("return this")()}function E(t){return t.toString().replace("function(","function (")}var A=function(t){var e,i="object"==typeof(e=k()).navigator&&"ReactNative"===e.navigator.product?"BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.":"BSON: No cryptographic implementation for random bytes present, falling back to a less secure implementation.";console.warn(i);for(var n=b.alloc(t),r=0;r<t;++r)n[r]=Math.floor(256*Math.random());return n},N=function(){if("undefined"!=typeof window){var t=window.crypto||window.msCrypto;if(t&&t.getRandomValues)return function(e){return t.getRandomValues(b.alloc(e))}}return void 0!==i.g&&i.g.crypto&&i.g.crypto.getRandomValues?function(t){return i.g.crypto.getRandomValues(b.alloc(t))}:A}();function B(t){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(t))}function T(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function U(t){return"[object BigInt64Array]"===Object.prototype.toString.call(t)}function j(t){return"[object BigUint64Array]"===Object.prototype.toString.call(t)}function I(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function R(t){return D(t)&&"[object Date]"===Object.prototype.toString.call(t)}function D(t){return"object"==typeof t&&null!==t}function L(t,e){var i=!1;return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return i||(console.warn(e),i=!0),t.apply(this,n)}}function P(t){if(ArrayBuffer.isView(t))return b.from(t.buffer,t.byteOffset,t.byteLength);if(B(t))return b.from(t);throw new S("Must use either Buffer or TypedArray")}var z=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,M=function(t){return"string"==typeof t&&z.test(t)},$=function(t){if(!M(t))throw new S('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');var e=t.replace(/-/g,"");return b.from(e,"hex")},C=function(t,e){return void 0===e&&(e=!0),e?t.toString("hex",0,4)+"-"+t.toString("hex",4,6)+"-"+t.toString("hex",6,8)+"-"+t.toString("hex",8,10)+"-"+t.toString("hex",10,16):t.toString("hex")},K=Symbol("id"),F=function(){function t(e){if(void 0===e)this.id=t.generate();else if(e instanceof t)this[K]=b.from(e.id),this.__id=e.__id;else if(ArrayBuffer.isView(e)&&16===e.byteLength)this.id=P(e);else{if("string"!=typeof e)throw new S("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");this.id=$(e)}}return Object.defineProperty(t.prototype,"id",{get:function(){return this[K]},set:function(e){this[K]=e,t.cacheHexString&&(this.__id=C(e))},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(e){if(void 0===e&&(e=!0),t.cacheHexString&&this.__id)return this.__id;var i=C(this.id,e);return t.cacheHexString&&(this.__id=i),i},t.prototype.toString=function(t){return t?this.id.toString(t):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(e){if(!e)return!1;if(e instanceof t)return e.id.equals(this.id);try{return new t(e).id.equals(this.id)}catch(t){return!1}},t.prototype.toBinary=function(){return new Z(this.id,Z.SUBTYPE_UUID)},t.generate=function(){var t=N(16);return t[6]=15&t[6]|64,t[8]=63&t[8]|128,b.from(t)},t.isValid=function(e){if(!e)return!1;if(e instanceof t)return!0;if("string"==typeof e)return M(e);if(T(e)){if(16!==e.length)return!1;try{return parseInt(e[6].toString(16)[0],10)===Z.SUBTYPE_UUID}catch(t){return!1}}return!1},t.createFromHexString=function(e){return new t($(e))},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new UUID("'.concat(this.toHexString(),'")')},t}();Object.defineProperty(F.prototype,"_bsontype",{value:"UUID"});var Z=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);if(!(null==e||"string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||Array.isArray(e)))throw new S("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=null!=i?i:t.BSON_BINARY_SUBTYPE_DEFAULT,null==e?(this.buffer=b.alloc(t.BUFFER_SIZE),this.position=0):("string"==typeof e?this.buffer=b.from(e,"binary"):Array.isArray(e)?this.buffer=b.from(e):this.buffer=P(e),this.position=this.buffer.byteLength)}return t.prototype.put=function(e){if("string"==typeof e&&1!==e.length)throw new S("only accepts single character String");if("number"!=typeof e&&1!==e.length)throw new S("only accepts single character Uint8Array or Array");var i;if((i="string"==typeof e?e.charCodeAt(0):"number"==typeof e?e:e[0])<0||i>255)throw new S("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.length>this.position)this.buffer[this.position++]=i;else{var n=b.alloc(t.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=i}},t.prototype.write=function(t,e){if(e="number"==typeof e?e:this.position,this.buffer.length<e+t.length){var i=b.alloc(this.buffer.length+t.length);this.buffer.copy(i,0,0,this.buffer.length),this.buffer=i}ArrayBuffer.isView(t)?(this.buffer.set(P(t),e),this.position=e+t.byteLength>this.position?e+t.length:this.position):"string"==typeof t&&(this.buffer.write(t,e,t.length,"binary"),this.position=e+t.length>this.position?e+t.length:this.position)},t.prototype.read=function(t,e){return e=e&&e>0?e:this.position,this.buffer.slice(t,t+e)},t.prototype.value=function(t){return(t=!!t)&&this.buffer.length===this.position?this.buffer:t?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position)},t.prototype.length=function(){return this.position},t.prototype.toJSON=function(){return this.buffer.toString("base64")},t.prototype.toString=function(t){return this.buffer.toString(t)},t.prototype.toExtendedJSON=function(t){t=t||{};var e=this.buffer.toString("base64"),i=Number(this.sub_type).toString(16);return t.legacy?{$binary:e,$type:1===i.length?"0"+i:i}:{$binary:{base64:e,subType:1===i.length?"0"+i:i}}},t.prototype.toUUID=function(){if(this.sub_type===t.SUBTYPE_UUID)return new F(this.buffer.slice(0,this.position));throw new x('Binary sub_type "'.concat(this.sub_type,'" is not supported for converting to UUID. Only "').concat(t.SUBTYPE_UUID,'" is currently supported.'))},t.fromExtendedJSON=function(e,i){var n,r;if(i=i||{},"$binary"in e?i.legacy&&"string"==typeof e.$binary&&"$type"in e?(r=e.$type?parseInt(e.$type,16):0,n=b.from(e.$binary,"base64")):"string"!=typeof e.$binary&&(r=e.$binary.subType?parseInt(e.$binary.subType,16):0,n=b.from(e.$binary.base64,"base64")):"$uuid"in e&&(r=4,n=$(e.$uuid)),!n)throw new S("Unexpected Binary Extended JSON format ".concat(JSON.stringify(e)));return new t(n,r)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var t=this.value(!0);return'new Binary(Buffer.from("'.concat(t.toString("hex"),'", "hex"), ').concat(this.sub_type,")")},t.BSON_BINARY_SUBTYPE_DEFAULT=0,t.BUFFER_SIZE=256,t.SUBTYPE_DEFAULT=0,t.SUBTYPE_FUNCTION=1,t.SUBTYPE_BYTE_ARRAY=2,t.SUBTYPE_UUID_OLD=3,t.SUBTYPE_UUID=4,t.SUBTYPE_MD5=5,t.SUBTYPE_ENCRYPTED=6,t.SUBTYPE_COLUMN=7,t.SUBTYPE_USER_DEFINED=128,t}();Object.defineProperty(Z.prototype,"_bsontype",{value:"Binary"});var Y=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.code=e,this.scope=i}return t.prototype.toJSON=function(){return{code:this.code,scope:this.scope}},t.prototype.toExtendedJSON=function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}},t.fromExtendedJSON=function(e){return new t(e.$code,e.$scope)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var t=this.toJSON();return'new Code("'.concat(String(t.code),'"').concat(t.scope?", ".concat(JSON.stringify(t.scope)):"",")")},t}();function J(t){return D(t)&&null!=t.$id&&"string"==typeof t.$ref&&(null==t.$db||"string"==typeof t.$db)}Object.defineProperty(Y.prototype,"_bsontype",{value:"Code"});var H=function(){function t(e,i,n,r){if(!(this instanceof t))return new t(e,i,n,r);var s=e.split(".");2===s.length&&(n=s.shift(),e=s.shift()),this.collection=e,this.oid=i,this.db=n,this.fields=r||{}}return Object.defineProperty(t.prototype,"namespace",{get:function(){return this.collection},set:function(t){this.collection=t},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){var t=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(t.$db=this.db),t},t.prototype.toExtendedJSON=function(t){t=t||{};var e={$ref:this.collection,$id:this.oid};return t.legacy?e:(this.db&&(e.$db=this.db),e=Object.assign(e,this.fields))},t.fromExtendedJSON=function(e){var i=Object.assign({},e);return delete i.$ref,delete i.$id,delete i.$db,new t(e.$ref,e.$id,e.$db,i)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var t=void 0===this.oid||void 0===this.oid.toString?this.oid:this.oid.toString();return'new DBRef("'.concat(this.namespace,'", new ObjectId("').concat(String(t),'")').concat(this.db?', "'.concat(this.db,'"'):"",")")},t}();Object.defineProperty(H.prototype,"_bsontype",{value:"DBRef"});var V=void 0;try{V=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}var q=4294967296,X=0x10000000000000000,W=X/2,G={},Q={},tt=function(){function t(e,i,n){if(void 0===e&&(e=0),!(this instanceof t))return new t(e,i,n);"bigint"==typeof e?Object.assign(this,t.fromBigInt(e,!!i)):"string"==typeof e?Object.assign(this,t.fromString(e,!!i)):(this.low=0|e,this.high=0|i,this.unsigned=!!n),Object.defineProperty(this,"__isLong__",{value:!0,configurable:!1,writable:!1,enumerable:!1})}return t.fromBits=function(e,i,n){return new t(e,i,n)},t.fromInt=function(e,i){var n,r,s;return i?(s=0<=(e>>>=0)&&e<256)&&(r=Q[e])?r:(n=t.fromBits(e,(0|e)<0?-1:0,!0),s&&(Q[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(r=G[e])?r:(n=t.fromBits(e,e<0?-1:0,!1),s&&(G[e]=n),n)},t.fromNumber=function(e,i){if(isNaN(e))return i?t.UZERO:t.ZERO;if(i){if(e<0)return t.UZERO;if(e>=X)return t.MAX_UNSIGNED_VALUE}else{if(e<=-W)return t.MIN_VALUE;if(e+1>=W)return t.MAX_VALUE}return e<0?t.fromNumber(-e,i).neg():t.fromBits(e%q|0,e/q|0,i)},t.fromBigInt=function(e,i){return t.fromString(e.toString(),i)},t.fromString=function(e,i,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t.ZERO;if("number"==typeof i?(n=i,i=!1):i=!!i,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return t.fromString(e.substring(1),i,n).neg();for(var s=t.fromNumber(Math.pow(n,8)),o=t.ZERO,a=0;a<e.length;a+=8){var l=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+l),n);if(l<8){var h=t.fromNumber(Math.pow(n,l));o=o.mul(h).add(t.fromNumber(u))}else o=(o=o.mul(s)).add(t.fromNumber(u))}return o.unsigned=i,o},t.fromBytes=function(e,i,n){return n?t.fromBytesLE(e,i):t.fromBytesBE(e,i)},t.fromBytesLE=function(e,i){return new t(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,i)},t.fromBytesBE=function(e,i){return new t(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],i)},t.isLong=function(t){return D(t)&&!0===t.__isLong__},t.fromValue=function(e,i){return"number"==typeof e?t.fromNumber(e,i):"string"==typeof e?t.fromString(e,i):t.fromBits(e.low,e.high,"boolean"==typeof i?i:e.unsigned)},t.prototype.add=function(e){t.isLong(e)||(e=t.fromValue(e));var i=this.high>>>16,n=65535&this.high,r=this.low>>>16,s=65535&this.low,o=e.high>>>16,a=65535&e.high,l=e.low>>>16,u=0,h=0,f=0,c=0;return f+=(c+=s+(65535&e.low))>>>16,c&=65535,h+=(f+=r+l)>>>16,f&=65535,u+=(h+=n+a)>>>16,h&=65535,u+=i+o,u&=65535,t.fromBits(f<<16|c,u<<16|h,this.unsigned)},t.prototype.and=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},t.prototype.compare=function(e){if(t.isLong(e)||(e=t.fromValue(e)),this.eq(e))return 0;var i=this.isNegative(),n=e.isNegative();return i&&!n?-1:!i&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},t.prototype.comp=function(t){return this.compare(t)},t.prototype.divide=function(e){if(t.isLong(e)||(e=t.fromValue(e)),e.isZero())throw Error("division by zero");if(V){if(!this.unsigned&&-2147483648===this.high&&-1===e.low&&-1===e.high)return this;var i=(this.unsigned?V.div_u:V.div_s)(this.low,this.high,e.low,e.high);return t.fromBits(i,V.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?t.UZERO:t.ZERO;var n,r,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return t.UZERO;if(e.gt(this.shru(1)))return t.UONE;s=t.UZERO}else{if(this.eq(t.MIN_VALUE))return e.eq(t.ONE)||e.eq(t.NEG_ONE)?t.MIN_VALUE:e.eq(t.MIN_VALUE)?t.ONE:(n=this.shr(1).div(e).shl(1)).eq(t.ZERO)?e.isNegative()?t.ONE:t.NEG_ONE:(r=this.sub(e.mul(n)),s=n.add(r.div(e)));if(e.eq(t.MIN_VALUE))return this.unsigned?t.UZERO:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=t.ZERO}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),a=o<=48?1:Math.pow(2,o-48),l=t.fromNumber(n),u=l.mul(e);u.isNegative()||u.gt(r);)n-=a,u=(l=t.fromNumber(n,this.unsigned)).mul(e);l.isZero()&&(l=t.ONE),s=s.add(l),r=r.sub(u)}return s},t.prototype.div=function(t){return this.divide(t)},t.prototype.equals=function(e){return t.isLong(e)||(e=t.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},t.prototype.eq=function(t){return this.equals(t)},t.prototype.getHighBits=function(){return this.high},t.prototype.getHighBitsUnsigned=function(){return this.high>>>0},t.prototype.getLowBits=function(){return this.low},t.prototype.getLowBitsUnsigned=function(){return this.low>>>0},t.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(t.MIN_VALUE)?64:this.neg().getNumBitsAbs();var e,i=0!==this.high?this.high:this.low;for(e=31;e>0&&0==(i&1<<e);e--);return 0!==this.high?e+33:e+1},t.prototype.greaterThan=function(t){return this.comp(t)>0},t.prototype.gt=function(t){return this.greaterThan(t)},t.prototype.greaterThanOrEqual=function(t){return this.comp(t)>=0},t.prototype.gte=function(t){return this.greaterThanOrEqual(t)},t.prototype.ge=function(t){return this.greaterThanOrEqual(t)},t.prototype.isEven=function(){return 0==(1&this.low)},t.prototype.isNegative=function(){return!this.unsigned&&this.high<0},t.prototype.isOdd=function(){return 1==(1&this.low)},t.prototype.isPositive=function(){return this.unsigned||this.high>=0},t.prototype.isZero=function(){return 0===this.high&&0===this.low},t.prototype.lessThan=function(t){return this.comp(t)<0},t.prototype.lt=function(t){return this.lessThan(t)},t.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},t.prototype.lte=function(t){return this.lessThanOrEqual(t)},t.prototype.modulo=function(e){if(t.isLong(e)||(e=t.fromValue(e)),V){var i=(this.unsigned?V.rem_u:V.rem_s)(this.low,this.high,e.low,e.high);return t.fromBits(i,V.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},t.prototype.mod=function(t){return this.modulo(t)},t.prototype.rem=function(t){return this.modulo(t)},t.prototype.multiply=function(e){if(this.isZero())return t.ZERO;if(t.isLong(e)||(e=t.fromValue(e)),V){var i=V.mul(this.low,this.high,e.low,e.high);return t.fromBits(i,V.get_high(),this.unsigned)}if(e.isZero())return t.ZERO;if(this.eq(t.MIN_VALUE))return e.isOdd()?t.MIN_VALUE:t.ZERO;if(e.eq(t.MIN_VALUE))return this.isOdd()?t.MIN_VALUE:t.ZERO;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(t.TWO_PWR_24)&&e.lt(t.TWO_PWR_24))return t.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=65535&this.high,s=this.low>>>16,o=65535&this.low,a=e.high>>>16,l=65535&e.high,u=e.low>>>16,h=65535&e.low,f=0,c=0,d=0,p=0;return d+=(p+=o*h)>>>16,p&=65535,c+=(d+=s*h)>>>16,d&=65535,c+=(d+=o*u)>>>16,d&=65535,f+=(c+=r*h)>>>16,c&=65535,f+=(c+=s*u)>>>16,c&=65535,f+=(c+=o*l)>>>16,c&=65535,f+=n*h+r*u+s*l+o*a,f&=65535,t.fromBits(d<<16|p,f<<16|c,this.unsigned)},t.prototype.mul=function(t){return this.multiply(t)},t.prototype.negate=function(){return!this.unsigned&&this.eq(t.MIN_VALUE)?t.MIN_VALUE:this.not().add(t.ONE)},t.prototype.neg=function(){return this.negate()},t.prototype.not=function(){return t.fromBits(~this.low,~this.high,this.unsigned)},t.prototype.notEquals=function(t){return!this.equals(t)},t.prototype.neq=function(t){return this.notEquals(t)},t.prototype.ne=function(t){return this.notEquals(t)},t.prototype.or=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},t.prototype.shiftLeft=function(e){return t.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?t.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):t.fromBits(0,this.low<<e-32,this.unsigned)},t.prototype.shl=function(t){return this.shiftLeft(t)},t.prototype.shiftRight=function(e){return t.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?t.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):t.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},t.prototype.shr=function(t){return this.shiftRight(t)},t.prototype.shiftRightUnsigned=function(e){if(t.isLong(e)&&(e=e.toInt()),0==(e&=63))return this;var i=this.high;if(e<32){var n=this.low;return t.fromBits(n>>>e|i<<32-e,i>>>e,this.unsigned)}return 32===e?t.fromBits(i,0,this.unsigned):t.fromBits(i>>>e-32,0,this.unsigned)},t.prototype.shr_u=function(t){return this.shiftRightUnsigned(t)},t.prototype.shru=function(t){return this.shiftRightUnsigned(t)},t.prototype.subtract=function(e){return t.isLong(e)||(e=t.fromValue(e)),this.add(e.neg())},t.prototype.sub=function(t){return this.subtract(t)},t.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},t.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*q+(this.low>>>0):this.high*q+(this.low>>>0)},t.prototype.toBigInt=function(){return BigInt(this.toString())},t.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},t.prototype.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},t.prototype.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},t.prototype.toSigned=function(){return this.unsigned?t.fromBits(this.low,this.high,!1):this},t.prototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(t.MIN_VALUE)){var i=t.fromNumber(e),n=this.div(i),r=n.mul(i).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var s=t.fromNumber(Math.pow(e,6),this.unsigned),o=this,a="";;){var l=o.div(s),u=(o.sub(l.mul(s)).toInt()>>>0).toString(e);if((o=l).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},t.prototype.toUnsigned=function(){return this.unsigned?this:t.fromBits(this.low,this.high,!0)},t.prototype.xor=function(e){return t.isLong(e)||(e=t.fromValue(e)),t.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},t.prototype.eqz=function(){return this.isZero()},t.prototype.le=function(t){return this.lessThanOrEqual(t)},t.prototype.toExtendedJSON=function(t){return t&&t.relaxed?this.toNumber():{$numberLong:this.toString()}},t.fromExtendedJSON=function(e,i){var n=t.fromString(e.$numberLong);return i&&i.relaxed?n.toNumber():n},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Long("'.concat(this.toString(),'"').concat(this.unsigned?", true":"",")")},t.TWO_PWR_24=t.fromInt(16777216),t.MAX_UNSIGNED_VALUE=t.fromBits(-1,-1,!0),t.ZERO=t.fromInt(0),t.UZERO=t.fromInt(0,!0),t.ONE=t.fromInt(1),t.UONE=t.fromInt(1,!0),t.NEG_ONE=t.fromInt(-1),t.MAX_VALUE=t.fromBits(-1,2147483647,!1),t.MIN_VALUE=t.fromBits(0,-2147483648,!1),t}();Object.defineProperty(tt.prototype,"__isLong__",{value:!0}),Object.defineProperty(tt.prototype,"_bsontype",{value:"Long"});var et=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,it=/^(\+|-)?(Infinity|inf)$/i,nt=/^(\+|-)?NaN$/i,rt=6111,st=-6176,ot=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),at=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),lt=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ut=/^([-+])?(\d+)?$/;function ht(t){return!isNaN(parseInt(t,10))}function ft(t){var e=tt.fromNumber(1e9),i=tt.fromNumber(0);if(!(t.parts[0]||t.parts[1]||t.parts[2]||t.parts[3]))return{quotient:t,rem:i};for(var n=0;n<=3;n++)i=(i=i.shiftLeft(32)).add(new tt(t.parts[n],0)),t.parts[n]=i.div(e).low,i=i.modulo(e);return{quotient:t,rem:i}}function ct(t,e){throw new S('"'.concat(t,'" is not a valid Decimal128 string - ').concat(e))}var dt=function(){function t(e){if(!(this instanceof t))return new t(e);if("string"==typeof e)this.bytes=t.fromString(e).bytes;else{if(!T(e))throw new S("Decimal128 must take a Buffer or string");if(16!==e.byteLength)throw new S("Decimal128 must take a Buffer of 16 bytes");this.bytes=e}}return t.fromString=function(e){var i,n=!1,r=!1,s=!1,o=0,a=0,l=0,u=0,h=0,f=[0],c=0,d=0,p=0,y=0,g=0,_=0,w=new tt(0,0),v=new tt(0,0),m=0;if(e.length>=7e3)throw new S(e+" not a valid Decimal128 string");var x=e.match(et),O=e.match(it),k=e.match(nt);if(!x&&!O&&!k||0===e.length)throw new S(e+" not a valid Decimal128 string");if(x){var E=x[2],A=x[4],N=x[5],B=x[6];A&&void 0===B&&ct(e,"missing exponent power"),A&&void 0===E&&ct(e,"missing exponent base"),void 0===A&&(N||B)&&ct(e,"missing e before exponent")}if("+"!==e[m]&&"-"!==e[m]||(n="-"===e[m++]),!ht(e[m])&&"."!==e[m]){if("i"===e[m]||"I"===e[m])return new t(b.from(n?at:lt));if("N"===e[m])return new t(b.from(ot))}for(;ht(e[m])||"."===e[m];)"."!==e[m]?(c<34&&("0"!==e[m]||s)&&(s||(h=a),s=!0,f[d++]=parseInt(e[m],10),c+=1),s&&(l+=1),r&&(u+=1),a+=1,m+=1):(r&&ct(e,"contains multiple periods"),r=!0,m+=1);if(r&&!a)throw new S(e+" not a valid Decimal128 string");if("e"===e[m]||"E"===e[m]){var T=e.substr(++m).match(ut);if(!T||!T[2])return new t(b.from(ot));g=parseInt(T[0],10),m+=T[0].length}if(e[m])return new t(b.from(ot));if(p=0,c){if(y=c-1,1!==(o=l))for(;0===f[h+o-1];)o-=1}else p=0,y=0,f[0]=0,l=1,c=1,o=0;for(g<=u&&u-g>16384?g=st:g-=u;g>rt;){if((y+=1)-p>34){if(f.join("").match(/^0+$/)){g=rt;break}ct(e,"overflow")}g-=1}for(;g<st||c<l;){if(0===y&&o<c){g=st,o=0;break}if(c<l?l-=1:y-=1,g<rt)g+=1;else{if(f.join("").match(/^0+$/)){g=rt;break}ct(e,"overflow")}}if(y-p+1<o){var U=a;r&&(h+=1,U+=1),n&&(h+=1,U+=1);var j=parseInt(e[h+y+1],10),I=0;if(j>=5&&(I=1,5===j))for(I=f[y]%2==1?1:0,_=h+y+2;_<U;_++)if(parseInt(e[_],10)){I=1;break}if(I)for(var R=y;R>=0;R--)if(++f[R]>9&&(f[R]=0,0===R)){if(!(g<rt))return new t(b.from(n?at:lt));g+=1,f[R]=1}}if(w=tt.fromNumber(0),v=tt.fromNumber(0),0===o)w=tt.fromNumber(0),v=tt.fromNumber(0);else if(y-p<17)for(R=p,v=tt.fromNumber(f[R++]),w=new tt(0,0);R<=y;R++)v=(v=v.multiply(tt.fromNumber(10))).add(tt.fromNumber(f[R]));else{for(R=p,w=tt.fromNumber(f[R++]);R<=y-17;R++)w=(w=w.multiply(tt.fromNumber(10))).add(tt.fromNumber(f[R]));for(v=tt.fromNumber(f[R++]);R<=y;R++)v=(v=v.multiply(tt.fromNumber(10))).add(tt.fromNumber(f[R]))}var D,L,P,z,M=function(t,e){if(!t&&!e)return{high:tt.fromNumber(0),low:tt.fromNumber(0)};var i=t.shiftRightUnsigned(32),n=new tt(t.getLowBits(),0),r=e.shiftRightUnsigned(32),s=new tt(e.getLowBits(),0),o=i.multiply(r),a=i.multiply(s),l=n.multiply(r),u=n.multiply(s);return o=o.add(a.shiftRightUnsigned(32)),a=new tt(a.getLowBits(),0).add(l).add(u.shiftRightUnsigned(32)),{high:o=o.add(a.shiftRightUnsigned(32)),low:u=a.shiftLeft(32).add(new tt(u.getLowBits(),0))}}(w,tt.fromString("100000000000000000"));M.low=M.low.add(v),L=v,((P=(D=M.low).high>>>0)<(z=L.high>>>0)||P===z&&D.low>>>0<L.low>>>0)&&(M.high=M.high.add(tt.fromNumber(1))),i=g+6176;var $={low:tt.fromNumber(0),high:tt.fromNumber(0)};M.high.shiftRightUnsigned(49).and(tt.fromNumber(1)).equals(tt.fromNumber(1))?($.high=$.high.or(tt.fromNumber(3).shiftLeft(61)),$.high=$.high.or(tt.fromNumber(i).and(tt.fromNumber(16383).shiftLeft(47))),$.high=$.high.or(M.high.and(tt.fromNumber(0x7fffffffffff)))):($.high=$.high.or(tt.fromNumber(16383&i).shiftLeft(49)),$.high=$.high.or(M.high.and(tt.fromNumber(562949953421311)))),$.low=M.low,n&&($.high=$.high.or(tt.fromString("9223372036854775808")));var C=b.alloc(16);return m=0,C[m++]=255&$.low.low,C[m++]=$.low.low>>8&255,C[m++]=$.low.low>>16&255,C[m++]=$.low.low>>24&255,C[m++]=255&$.low.high,C[m++]=$.low.high>>8&255,C[m++]=$.low.high>>16&255,C[m++]=$.low.high>>24&255,C[m++]=255&$.high.low,C[m++]=$.high.low>>8&255,C[m++]=$.high.low>>16&255,C[m++]=$.high.low>>24&255,C[m++]=255&$.high.high,C[m++]=$.high.high>>8&255,C[m++]=$.high.high>>16&255,C[m++]=$.high.high>>24&255,new t(C)},t.prototype.toString=function(){for(var t,e=0,i=new Array(36),n=0;n<i.length;n++)i[n]=0;var r,s,o,a=0,l=!1,u={parts:[0,0,0,0]},h=[];a=0;var f=this.bytes,c=f[a++]|f[a++]<<8|f[a++]<<16|f[a++]<<24,d=f[a++]|f[a++]<<8|f[a++]<<16|f[a++]<<24,p=f[a++]|f[a++]<<8|f[a++]<<16|f[a++]<<24,y=f[a++]|f[a++]<<8|f[a++]<<16|f[a++]<<24;a=0,(new tt(c,d),new tt(p,y)).lessThan(tt.ZERO)&&h.push("-");var g=y>>26&31;if(g>>3==3){if(30===g)return h.join("")+"Infinity";if(31===g)return"NaN";t=y>>15&16383,r=8+(y>>14&1)}else r=y>>14&7,t=y>>17&16383;var _=t-6176;if(u.parts[0]=(16383&y)+((15&r)<<14),u.parts[1]=p,u.parts[2]=d,u.parts[3]=c,0===u.parts[0]&&0===u.parts[1]&&0===u.parts[2]&&0===u.parts[3])l=!0;else for(o=3;o>=0;o--){var b=0,w=ft(u);if(u=w.quotient,b=w.rem.low)for(s=8;s>=0;s--)i[9*o+s]=b%10,b=Math.floor(b/10)}if(l)e=1,i[a]=0;else for(e=36;!i[a];)e-=1,a+=1;var v=e-1+_;if(v>=34||v<=-7||_>0){if(e>34)return h.push("".concat(0)),_>0?h.push("E+".concat(_)):_<0&&h.push("E".concat(_)),h.join("");for(h.push("".concat(i[a++])),(e-=1)&&h.push("."),n=0;n<e;n++)h.push("".concat(i[a++]));h.push("E"),v>0?h.push("+".concat(v)):h.push("".concat(v))}else if(_>=0)for(n=0;n<e;n++)h.push("".concat(i[a++]));else{var m=e+_;if(m>0)for(n=0;n<m;n++)h.push("".concat(i[a++]));else h.push("0");for(h.push(".");m++<0;)h.push("0");for(n=0;n<e-Math.max(m-1,0);n++)h.push("".concat(i[a++]))}return h.join("")},t.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},t.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},t.fromExtendedJSON=function(e){return t.fromString(e.$numberDecimal)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new Decimal128("'.concat(this.toString(),'")')},t}();Object.defineProperty(dt.prototype,"_bsontype",{value:"Decimal128"});var pt=function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=+e}return t.prototype.valueOf=function(){return this.value},t.prototype.toJSON=function(){return this.value},t.prototype.toString=function(t){return this.value.toString(t)},t.prototype.toExtendedJSON=function(t){return t&&(t.legacy||t.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-".concat(this.value.toFixed(1))}:(Number.isInteger(this.value)?(e=this.value.toFixed(1)).length>=13&&(e=this.value.toExponential(13).toUpperCase()):e=this.value.toString(),{$numberDouble:e});var e},t.fromExtendedJSON=function(e,i){var n=parseFloat(e.$numberDouble);return i&&i.relaxed?n:new t(n)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){var t=this.toExtendedJSON();return"new Double(".concat(t.$numberDouble,")")},t}();Object.defineProperty(pt.prototype,"_bsontype",{value:"Double"});var yt=function(){function t(e){if(!(this instanceof t))return new t(e);e instanceof Number&&(e=e.valueOf()),this.value=0|+e}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(t){return this.value.toString(t)},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(t){return t&&(t.relaxed||t.legacy)?this.value:{$numberInt:this.value.toString()}},t.fromExtendedJSON=function(e,i){return i&&i.relaxed?parseInt(e.$numberInt,10):new t(e.$numberInt)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new Int32(".concat(this.valueOf(),")")},t}();Object.defineProperty(yt.prototype,"_bsontype",{value:"Int32"});var gt=function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$maxKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MaxKey()"},t}();Object.defineProperty(gt.prototype,"_bsontype",{value:"MaxKey"});var _t=function(){function t(){if(!(this instanceof t))return new t}return t.prototype.toExtendedJSON=function(){return{$minKey:1}},t.fromExtendedJSON=function(){return new t},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return"new MinKey()"},t}();Object.defineProperty(_t.prototype,"_bsontype",{value:"MinKey"});var bt=new RegExp("^[0-9a-fA-F]{24}$"),wt=null,vt=Symbol("id"),mt=function(){function t(e){if(!(this instanceof t))return new t(e);var i;if("object"==typeof e&&e&&"id"in e){if("string"!=typeof e.id&&!ArrayBuffer.isView(e.id))throw new S("Argument passed in must have an id that is of type string or Buffer");i="toHexString"in e&&"function"==typeof e.toHexString?b.from(e.toHexString(),"hex"):e.id}else i=e;if(null==i||"number"==typeof i)this[vt]=t.generate("number"==typeof i?i:void 0);else if(ArrayBuffer.isView(i)&&12===i.byteLength)this[vt]=i instanceof b?i:P(i);else{if("string"!=typeof i)throw new S("Argument passed in does not match the accepted types");if(12===i.length){var n=b.from(i);if(12!==n.byteLength)throw new S("Argument passed in must be a string of 12 bytes");this[vt]=n}else{if(24!==i.length||!bt.test(i))throw new S("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");this[vt]=b.from(i,"hex")}}t.cacheHexString&&(this.__id=this.id.toString("hex"))}return Object.defineProperty(t.prototype,"id",{get:function(){return this[vt]},set:function(e){this[vt]=e,t.cacheHexString&&(this.__id=e.toString("hex"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"generationTime",{get:function(){return this.id.readInt32BE(0)},set:function(t){this.id.writeUInt32BE(t,0)},enumerable:!1,configurable:!0}),t.prototype.toHexString=function(){if(t.cacheHexString&&this.__id)return this.__id;var e=this.id.toString("hex");return t.cacheHexString&&!this.__id&&(this.__id=e),e},t.getInc=function(){return t.index=(t.index+1)%16777215},t.generate=function(e){"number"!=typeof e&&(e=Math.floor(Date.now()/1e3));var i=t.getInc(),n=b.alloc(12);return n.writeUInt32BE(e,0),null===wt&&(wt=N(5)),n[4]=wt[0],n[5]=wt[1],n[6]=wt[2],n[7]=wt[3],n[8]=wt[4],n[11]=255&i,n[10]=i>>8&255,n[9]=i>>16&255,n},t.prototype.toString=function(t){return t?this.id.toString(t):this.toHexString()},t.prototype.toJSON=function(){return this.toHexString()},t.prototype.equals=function(e){if(null==e)return!1;if(e instanceof t)return this[vt][11]===e[vt][11]&&this[vt].equals(e[vt]);if("string"==typeof e&&t.isValid(e)&&12===e.length&&T(this.id))return e===b.prototype.toString.call(this.id,"latin1");if("string"==typeof e&&t.isValid(e)&&24===e.length)return e.toLowerCase()===this.toHexString();if("string"==typeof e&&t.isValid(e)&&12===e.length)return b.from(e).equals(this.id);if("object"==typeof e&&"toHexString"in e&&"function"==typeof e.toHexString){var i=e.toHexString(),n=this.toHexString().toLowerCase();return"string"==typeof i&&i.toLowerCase()===n}return!1},t.prototype.getTimestamp=function(){var t=new Date,e=this.id.readUInt32BE(0);return t.setTime(1e3*Math.floor(e)),t},t.createPk=function(){return new t},t.createFromTime=function(e){var i=b.from([0,0,0,0,0,0,0,0,0,0,0,0]);return i.writeUInt32BE(e,0),new t(i)},t.createFromHexString=function(e){if(void 0===e||null!=e&&24!==e.length)throw new S("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new t(b.from(e,"hex"))},t.isValid=function(e){if(null==e)return!1;try{return new t(e),!0}catch(t){return!1}},t.prototype.toExtendedJSON=function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}},t.fromExtendedJSON=function(e){return new t(e.$oid)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t.prototype.inspect=function(){return'new ObjectId("'.concat(this.toHexString(),'")')},t.index=Math.floor(16777215*Math.random()),t}();Object.defineProperty(mt.prototype,"generate",{value:L((function(t){return mt.generate(t)}),"Please use the static `ObjectId.generate(time)` instead")}),Object.defineProperty(mt.prototype,"getInc",{value:L((function(){return mt.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(mt.prototype,"get_inc",{value:L((function(){return mt.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(mt,"get_inc",{value:L((function(){return mt.getInc()}),"Please use the static `ObjectId.getInc()` instead")}),Object.defineProperty(mt.prototype,"_bsontype",{value:"ObjectID"});var xt=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);if(this.pattern=e,this.options=(null!=i?i:"").split("").sort().join(""),-1!==this.pattern.indexOf("\0"))throw new x("BSON Regex patterns cannot contain null bytes, found: ".concat(JSON.stringify(this.pattern)));if(-1!==this.options.indexOf("\0"))throw new x("BSON Regex options cannot contain null bytes, found: ".concat(JSON.stringify(this.options)));for(var n=0;n<this.options.length;n++)if("i"!==this.options[n]&&"m"!==this.options[n]&&"x"!==this.options[n]&&"l"!==this.options[n]&&"s"!==this.options[n]&&"u"!==this.options[n])throw new x("The regular expression option [".concat(this.options[n],"] is not supported"))}return t.parseOptions=function(t){return t?t.split("").sort().join(""):""},t.prototype.toExtendedJSON=function(t){return(t=t||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}},t.fromExtendedJSON=function(e){if("$regex"in e){if("string"==typeof e.$regex)return new t(e.$regex,t.parseOptions(e.$options));if("BSONRegExp"===e.$regex._bsontype)return e}if("$regularExpression"in e)return new t(e.$regularExpression.pattern,t.parseOptions(e.$regularExpression.options));throw new S("Unexpected BSONRegExp EJSON object form: ".concat(JSON.stringify(e)))},t}();Object.defineProperty(xt.prototype,"_bsontype",{value:"BSONRegExp"});var St=function(){function t(e){if(!(this instanceof t))return new t(e);this.value=e}return t.prototype.valueOf=function(){return this.value},t.prototype.toString=function(){return this.value},t.prototype.inspect=function(){return'new BSONSymbol("'.concat(this.value,'")')},t.prototype.toJSON=function(){return this.value},t.prototype.toExtendedJSON=function(){return{$symbol:this.value}},t.fromExtendedJSON=function(e){return new t(e.$symbol)},t.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},t}();Object.defineProperty(St.prototype,"_bsontype",{value:"Symbol"});var Ot=tt,kt=function(t){function e(i,n){var r=this;return r instanceof e?(r=tt.isLong(i)?t.call(this,i.low,i.high,!0)||this:D(i)&&void 0!==i.t&&void 0!==i.i?t.call(this,i.i,i.t,!0)||this:t.call(this,i,n,!0)||this,Object.defineProperty(r,"_bsontype",{value:"Timestamp",writable:!1,configurable:!1,enumerable:!1}),r):new e(i,n)}return v(e,t),e.prototype.toJSON=function(){return{$timestamp:this.toString()}},e.fromInt=function(t){return new e(tt.fromInt(t,!0))},e.fromNumber=function(t){return new e(tt.fromNumber(t,!0))},e.fromBits=function(t,i){return new e(t,i)},e.fromString=function(t,i){return new e(tt.fromString(t,!0,i))},e.prototype.toExtendedJSON=function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}},e.fromExtendedJSON=function(t){return new e(t.$timestamp)},e.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return this.inspect()},e.prototype.inspect=function(){return"new Timestamp({ t: ".concat(this.getHighBits(),", i: ").concat(this.getLowBits()," })")},e.MAX_VALUE=tt.MAX_UNSIGNED_VALUE,e}(Ot);function Et(t){return D(t)&&Reflect.has(t,"_bsontype")&&"string"==typeof t._bsontype}var At=2147483647,Nt=-2147483648,Bt=0x8000000000000000,Tt=-0x8000000000000000,Ut={$oid:mt,$binary:Z,$uuid:Z,$symbol:St,$numberInt:yt,$numberDecimal:dt,$numberDouble:pt,$numberLong:tt,$minKey:_t,$maxKey:gt,$regex:xt,$regularExpression:xt,$timestamp:kt};function jt(t,e){if(void 0===e&&(e={}),"number"==typeof t){if(e.relaxed||e.legacy)return t;if(Math.floor(t)===t){if(t>=Nt&&t<=At)return new yt(t);if(t>=Tt&&t<=Bt)return tt.fromNumber(t)}return new pt(t)}if(null==t||"object"!=typeof t)return t;if(t.$undefined)return null;for(var i=Object.keys(t).filter((function(e){return e.startsWith("$")&&null!=t[e]})),n=0;n<i.length;n++){var r=Ut[i[n]];if(r)return r.fromExtendedJSON(t,e)}if(null!=t.$date){var s=t.$date,o=new Date;return e.legacy?"number"==typeof s?o.setTime(s):"string"==typeof s&&o.setTime(Date.parse(s)):"string"==typeof s?o.setTime(Date.parse(s)):tt.isLong(s)?o.setTime(s.toNumber()):"number"==typeof s&&e.relaxed&&o.setTime(s),o}if(null!=t.$code){var a=Object.assign({},t);return t.$scope&&(a.$scope=jt(t.$scope)),Y.fromExtendedJSON(t)}if(J(t)||t.$dbPointer){var l=t.$ref?t:t.$dbPointer;if(l instanceof H)return l;var u=Object.keys(l).filter((function(t){return t.startsWith("$")})),h=!0;if(u.forEach((function(t){-1===["$ref","$id","$db"].indexOf(t)&&(h=!1)})),h)return H.fromExtendedJSON(l)}return t}function It(t){var e=t.toISOString();return 0!==t.getUTCMilliseconds()?e:e.slice(0,-5)+"Z"}function Rt(t,e){if(("object"==typeof t||"function"==typeof t)&&null!==t){var i=e.seenObjects.findIndex((function(e){return e.obj===t}));if(-1!==i){var n=e.seenObjects.map((function(t){return t.propertyName})),r=n.slice(0,i).map((function(t){return"".concat(t," -> ")})).join(""),s=n[i],o=" -> "+n.slice(i+1,n.length-1).map((function(t){return"".concat(t," -> ")})).join(""),a=n[n.length-1],l=" ".repeat(r.length+s.length/2),u="-".repeat(o.length+(s.length+a.length)/2-1);throw new S("Converting circular structure to EJSON:\n"+"    ".concat(r).concat(s).concat(o).concat(a,"\n")+"    ".concat(l,"\\").concat(u,"/"))}e.seenObjects[e.seenObjects.length-1].obj=t}if(Array.isArray(t))return function(t,e){return t.map((function(t,i){e.seenObjects.push({propertyName:"index ".concat(i),obj:null});try{return Rt(t,e)}finally{e.seenObjects.pop()}}))}(t,e);if(void 0===t)return null;if(t instanceof Date||R(t)){var h=t.getTime(),f=h>-1&&h<2534023188e5;return e.legacy?e.relaxed&&f?{$date:t.getTime()}:{$date:It(t)}:e.relaxed&&f?{$date:It(t)}:{$date:{$numberLong:t.getTime().toString()}}}if(!("number"!=typeof t||e.relaxed&&isFinite(t))){if(Math.floor(t)===t){var c=t>=Tt&&t<=Bt;if(t>=Nt&&t<=At)return{$numberInt:t.toString()};if(c)return{$numberLong:t.toString()}}return{$numberDouble:t.toString()}}if(t instanceof RegExp||I(t)){var d=t.flags;if(void 0===d){var p=t.toString().match(/[gimuy]*$/);p&&(d=p[0])}return new xt(t.source,d).toExtendedJSON(e)}return null!=t&&"object"==typeof t?function(t,e){if(null==t||"object"!=typeof t)throw new x("not an object instance");var i=t._bsontype;if(void 0===i){var n={};for(var r in t){e.seenObjects.push({propertyName:r,obj:null});try{var s=Rt(t[r],e);"__proto__"===r?Object.defineProperty(n,r,{value:s,writable:!0,enumerable:!0,configurable:!0}):n[r]=s}finally{e.seenObjects.pop()}}return n}if(Et(t)){var o=t;if("function"!=typeof o.toExtendedJSON){var a=Pt[t._bsontype];if(!a)throw new S("Unrecognized or invalid _bsontype: "+t._bsontype);o=a(o)}return"Code"===i&&o.scope?o=new Y(o.code,Rt(o.scope,e)):"DBRef"===i&&o.oid&&(o=new H(Rt(o.collection,e),Rt(o.oid,e),Rt(o.db,e),Rt(o.fields,e))),o.toExtendedJSON(e)}throw new x("_bsontype must be a string, but was: "+typeof i)}(t,e):t}var Dt,Lt,Pt={Binary:function(t){return new Z(t.value(),t.sub_type)},Code:function(t){return new Y(t.code,t.scope)},DBRef:function(t){return new H(t.collection||t.namespace,t.oid,t.db,t.fields)},Decimal128:function(t){return new dt(t.bytes)},Double:function(t){return new pt(t.value)},Int32:function(t){return new yt(t.value)},Long:function(t){return tt.fromBits(null!=t.low?t.low:t.low_,null!=t.low?t.high:t.high_,null!=t.low?t.unsigned:t.unsigned_)},MaxKey:function(){return new gt},MinKey:function(){return new _t},ObjectID:function(t){return new mt(t)},ObjectId:function(t){return new mt(t)},BSONRegExp:function(t){return new xt(t.pattern,t.options)},Symbol:function(t){return new St(t.value)},Timestamp:function(t){return kt.fromBits(t.low,t.high)}};!function(t){function e(t,e){var i=Object.assign({},{relaxed:!0,legacy:!1},e);return"boolean"==typeof i.relaxed&&(i.strict=!i.relaxed),"boolean"==typeof i.strict&&(i.relaxed=!i.strict),JSON.parse(t,(function(t,e){if(-1!==t.indexOf("\0"))throw new x("BSON Document field names cannot contain null bytes, found: ".concat(JSON.stringify(t)));return jt(e,i)}))}function i(t,e,i,n){null!=i&&"object"==typeof i&&(n=i,i=0),null==e||"object"!=typeof e||Array.isArray(e)||(n=e,e=void 0,i=0);var r=Rt(t,Object.assign({relaxed:!0,legacy:!1},n,{seenObjects:[{propertyName:"(root)",obj:null}]}));return JSON.stringify(r,e,i)}t.parse=e,t.stringify=i,t.serialize=function(t,e){return e=e||{},JSON.parse(i(t,e))},t.deserialize=function(t,i){return i=i||{},e(JSON.stringify(t),i)}}(Dt||(Dt={}));var zt=k();Lt=zt.Map?zt.Map:function(){function t(t){void 0===t&&(t=[]),this._keys=[],this._values={};for(var e=0;e<t.length;e++)if(null!=t[e]){var i=t[e],n=i[0],r=i[1];this._keys.push(n),this._values[n]={v:r,i:this._keys.length-1}}}return t.prototype.clear=function(){this._keys=[],this._values={}},t.prototype.delete=function(t){var e=this._values[t];return null!=e&&(delete this._values[t],this._keys.splice(e.i,1),!0)},t.prototype.entries=function(){var t=this,e=0;return{next:function(){var i=t._keys[e++];return{value:void 0!==i?[i,t._values[i].v]:void 0,done:void 0===i}}}},t.prototype.forEach=function(t,e){e=e||this;for(var i=0;i<this._keys.length;i++){var n=this._keys[i];t.call(e,this._values[n].v,n,e)}},t.prototype.get=function(t){return this._values[t]?this._values[t].v:void 0},t.prototype.has=function(t){return null!=this._values[t]},t.prototype.keys=function(){var t=this,e=0;return{next:function(){var i=t._keys[e++];return{value:void 0!==i?i:void 0,done:void 0===i}}}},t.prototype.set=function(t,e){return this._values[t]?(this._values[t].v=e,this):(this._keys.push(t),this._values[t]={v:e,i:this._keys.length-1},this)},t.prototype.values=function(){var t=this,e=0;return{next:function(){var i=t._keys[e++];return{value:void 0!==i?t._values[i].v:void 0,done:void 0===i}}}},Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!1,configurable:!0}),t}();var Mt=2147483647,$t=-2147483648,Ct=Math.pow(2,63)-1,Kt=-Math.pow(2,63),Ft=Math.pow(2,53),Zt=-Math.pow(2,53),Yt=1,Jt=2,Ht=3,Vt=4,qt=5,Xt=6,Wt=7,Gt=8,Qt=9,te=10,ee=11,ie=12,ne=13,re=14,se=15,oe=16,ae=17,le=18,ue=19,he=255,fe=127,ce=0,de=1,pe=2,ye=3,ge=4,_e=5,be=6,we=7,ve=128;function me(t,e,i){var n=5;if(Array.isArray(t))for(var r=0;r<t.length;r++)n+=xe(r.toString(),t[r],e,!0,i);else for(var s in"function"==typeof(null==t?void 0:t.toBSON)&&(t=t.toBSON()),t)n+=xe(s,t[s],e,!1,i);return n}function xe(t,e,i,n,r){switch(void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),"function"==typeof(null==e?void 0:e.toBSON)&&(e=e.toBSON()),typeof e){case"string":return 1+b.byteLength(t,"utf8")+1+4+b.byteLength(e,"utf8")+1;case"number":return Math.floor(e)===e&&e>=Zt&&e<=Ft&&e>=$t&&e<=Mt?(null!=t?b.byteLength(t,"utf8")+1:0)+5:(null!=t?b.byteLength(t,"utf8")+1:0)+9;case"undefined":return n||!r?(null!=t?b.byteLength(t,"utf8")+1:0)+1:0;case"boolean":return(null!=t?b.byteLength(t,"utf8")+1:0)+2;case"object":if(null==e||"MinKey"===e._bsontype||"MaxKey"===e._bsontype)return(null!=t?b.byteLength(t,"utf8")+1:0)+1;if("ObjectId"===e._bsontype||"ObjectID"===e._bsontype)return(null!=t?b.byteLength(t,"utf8")+1:0)+13;if(e instanceof Date||R(e))return(null!=t?b.byteLength(t,"utf8")+1:0)+9;if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||B(e))return(null!=t?b.byteLength(t,"utf8")+1:0)+6+e.byteLength;if("Long"===e._bsontype||"Double"===e._bsontype||"Timestamp"===e._bsontype)return(null!=t?b.byteLength(t,"utf8")+1:0)+9;if("Decimal128"===e._bsontype)return(null!=t?b.byteLength(t,"utf8")+1:0)+17;if("Code"===e._bsontype)return null!=e.scope&&Object.keys(e.scope).length>0?(null!=t?b.byteLength(t,"utf8")+1:0)+1+4+4+b.byteLength(e.code.toString(),"utf8")+1+me(e.scope,i,r):(null!=t?b.byteLength(t,"utf8")+1:0)+1+4+b.byteLength(e.code.toString(),"utf8")+1;if("Binary"===e._bsontype){var s=e;return s.sub_type===Z.SUBTYPE_BYTE_ARRAY?(null!=t?b.byteLength(t,"utf8")+1:0)+(s.position+1+4+1+4):(null!=t?b.byteLength(t,"utf8")+1:0)+(s.position+1+4+1)}if("Symbol"===e._bsontype)return(null!=t?b.byteLength(t,"utf8")+1:0)+b.byteLength(e.value,"utf8")+4+1+1;if("DBRef"===e._bsontype){var o=Object.assign({$ref:e.collection,$id:e.oid},e.fields);return null!=e.db&&(o.$db=e.db),(null!=t?b.byteLength(t,"utf8")+1:0)+1+me(o,i,r)}return e instanceof RegExp||I(e)?(null!=t?b.byteLength(t,"utf8")+1:0)+1+b.byteLength(e.source,"utf8")+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1:"BSONRegExp"===e._bsontype?(null!=t?b.byteLength(t,"utf8")+1:0)+1+b.byteLength(e.pattern,"utf8")+1+b.byteLength(e.options,"utf8")+1:(null!=t?b.byteLength(t,"utf8")+1:0)+me(e,i,r)+1;case"function":if(e instanceof RegExp||I(e)||"[object RegExp]"===String.call(e))return(null!=t?b.byteLength(t,"utf8")+1:0)+1+b.byteLength(e.source,"utf8")+1+(e.global?1:0)+(e.ignoreCase?1:0)+(e.multiline?1:0)+1;if(i&&null!=e.scope&&Object.keys(e.scope).length>0)return(null!=t?b.byteLength(t,"utf8")+1:0)+1+4+4+b.byteLength(E(e),"utf8")+1+me(e.scope,i,r);if(i)return(null!=t?b.byteLength(t,"utf8")+1:0)+1+4+b.byteLength(E(e),"utf8")+1}return 0}function Se(t,e,i){for(var n=0,r=e;r<i;r+=1){var s=t[r];if(n){if(128!=(192&s))return!1;n-=1}else if(128&s)if(192==(224&s))n=1;else if(224==(240&s))n=2;else{if(240!=(248&s))return!1;n=3}}return!n}var Oe=tt.fromNumber(Ft),ke=tt.fromNumber(Zt),Ee={};function Ae(t,e,i){var n=(e=null==e?{}:e)&&e.index?e.index:0,r=t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24;if(r<5)throw new x("bson size must be >= 5, is ".concat(r));if(e.allowObjectSmallerThanBufferSize&&t.length<r)throw new x("buffer length ".concat(t.length," must be >= bson size ").concat(r));if(!e.allowObjectSmallerThanBufferSize&&t.length!==r)throw new x("buffer length ".concat(t.length," must === bson size ").concat(r));if(r+n>t.byteLength)throw new x("(bson size ".concat(r," + options.index ").concat(n," must be <= buffer length ").concat(t.byteLength,")"));if(0!==t[n+r-1])throw new x("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return Be(t,n,e,i)}var Ne=/^\$ref$|^\$id$|^\$db$/;function Be(t,e,i,n){void 0===n&&(n=!1);var r,s=null!=i.evalFunctions&&i.evalFunctions,o=null!=i.cacheFunctions&&i.cacheFunctions,a=null==i.fieldsAsRaw?null:i.fieldsAsRaw,l=null!=i.raw&&i.raw,u="boolean"==typeof i.bsonRegExp&&i.bsonRegExp,h=null!=i.promoteBuffers&&i.promoteBuffers,f=null==i.promoteLongs||i.promoteLongs,c=null==i.promoteValues||i.promoteValues,d=null==i.validation?{utf8:!0}:i.validation,p=!0,y=new Set,g=d.utf8;if("boolean"==typeof g)r=g;else{p=!1;var _=Object.keys(g).map((function(t){return g[t]}));if(0===_.length)throw new x("UTF-8 validation setting cannot be empty");if("boolean"!=typeof _[0])throw new x("Invalid UTF-8 validation option, must specify boolean values");if(r=_[0],!_.every((function(t){return t===r})))throw new x("Invalid UTF-8 validation option - keys must be all true or all false")}if(!p)for(var w=0,v=Object.keys(g);w<v.length;w++){var S=v[w];y.add(S)}var O=e;if(t.length<5)throw new x("corrupt bson message < 5 bytes long");var k=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;if(k<5||k>t.length)throw new x("corrupt bson message");for(var E=n?[]:{},A=0,N=!n&&null,B=new DataView(t.buffer,t.byteOffset,t.byteLength);;){var T=t[e++];if(0===T)break;for(var U=e;0!==t[U]&&U<t.length;)U++;if(U>=t.byteLength)throw new x("Bad BSON Document: illegal CString");var j,I=n?A++:t.toString("utf8",e,U);j=p||y.has(I)?r:!r,!1!==N&&"$"===I[0]&&(N=Ne.test(I));var R=void 0;if(e=U+1,T===Jt){if((ut=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||ut>t.length-e||0!==t[e+ut-1])throw new x("bad string length in bson");R=Ue(t,e,e+ut-1,j),e+=ut}else if(T===Wt){var D=b.alloc(12);t.copy(D,0,e,e+12),R=new mt(D),e+=12}else if(T===oe&&!1===c)R=new yt(t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24);else if(T===oe)R=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;else if(T===Yt&&!1===c)R=new pt(B.getFloat64(e,!0)),e+=8;else if(T===Yt)R=B.getFloat64(e,!0),e+=8;else if(T===Qt){var L=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,P=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;R=new Date(new tt(L,P).toNumber())}else if(T===Gt){if(0!==t[e]&&1!==t[e])throw new x("illegal boolean type value");R=1===t[e++]}else if(T===Ht){var z=e;if((at=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)<=0||at>t.length-e)throw new x("bad embedded document length in bson");if(l)R=t.slice(e,e+at);else{var M=i;p||(M=m(m({},i),{validation:{utf8:j}})),R=Be(t,z,M,!1)}e+=at}else if(T===Vt){z=e;var $=i,C=e+(at=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24);if(a&&a[I]){for(var K in $={},i)$[K]=i[K];$.raw=!0}if(p||($=m(m({},$),{validation:{utf8:j}})),R=Be(t,z,$,!0),0!==t[(e+=at)-1])throw new x("invalid array terminator byte");if(e!==C)throw new x("corrupted array bson")}else if(T===Xt)R=void 0;else if(T===te)R=null;else if(T===le){L=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,P=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;var F=new tt(L,P);R=f&&!0===c&&F.lessThanOrEqual(Oe)&&F.greaterThanOrEqual(ke)?F.toNumber():F}else if(T===ue){var V=b.alloc(16);t.copy(V,0,e,e+16),e+=16;var q=new dt(V);R="toObject"in q&&"function"==typeof q.toObject?q.toObject():q}else if(T===qt){var X=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,W=X,G=t[e++];if(X<0)throw new x("Negative binary type element size found");if(X>t.byteLength)throw new x("Binary type size larger than document size");if(null!=t.slice){if(G===Z.SUBTYPE_BYTE_ARRAY){if((X=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<0)throw new x("Negative binary type element size found for subtype 0x02");if(X>W-4)throw new x("Binary type with subtype 0x02 contains too long binary size");if(X<W-4)throw new x("Binary type with subtype 0x02 contains too short binary size")}R=h&&c?t.slice(e,e+X):new Z(t.slice(e,e+X),G)}else{var Q=b.alloc(X);if(G===Z.SUBTYPE_BYTE_ARRAY){if((X=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<0)throw new x("Negative binary type element size found for subtype 0x02");if(X>W-4)throw new x("Binary type with subtype 0x02 contains too long binary size");if(X<W-4)throw new x("Binary type with subtype 0x02 contains too short binary size")}for(U=0;U<X;U++)Q[U]=t[e+U];R=h&&c?Q:new Z(Q,G)}e+=X}else if(T===ee&&!1===u){for(U=e;0!==t[U]&&U<t.length;)U++;if(U>=t.length)throw new x("Bad BSON Document: illegal CString");var et=t.toString("utf8",e,U);for(U=e=U+1;0!==t[U]&&U<t.length;)U++;if(U>=t.length)throw new x("Bad BSON Document: illegal CString");var it=t.toString("utf8",e,U);e=U+1;var nt=new Array(it.length);for(U=0;U<it.length;U++)switch(it[U]){case"m":nt[U]="m";break;case"s":nt[U]="g";break;case"i":nt[U]="i"}R=new RegExp(et,nt.join(""))}else if(T===ee&&!0===u){for(U=e;0!==t[U]&&U<t.length;)U++;if(U>=t.length)throw new x("Bad BSON Document: illegal CString");for(et=t.toString("utf8",e,U),U=e=U+1;0!==t[U]&&U<t.length;)U++;if(U>=t.length)throw new x("Bad BSON Document: illegal CString");it=t.toString("utf8",e,U),e=U+1,R=new xt(et,it)}else if(T===re){if((ut=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||ut>t.length-e||0!==t[e+ut-1])throw new x("bad string length in bson");var rt=Ue(t,e,e+ut-1,j);R=c?rt:new St(rt),e+=ut}else if(T===ae)L=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,P=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24,R=new kt(L,P);else if(T===he)R=new _t;else if(T===fe)R=new gt;else if(T===ne){if((ut=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||ut>t.length-e||0!==t[e+ut-1])throw new x("bad string length in bson");var st=Ue(t,e,e+ut-1,j);R=s?o?Te(st,Ee,E):Te(st):new Y(st),e+=ut}else if(T===se){var ot=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24;if(ot<13)throw new x("code_w_scope total size shorter minimum expected length");if((ut=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||ut>t.length-e||0!==t[e+ut-1])throw new x("bad string length in bson");st=Ue(t,e,e+ut-1,j),z=e+=ut;var at=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,lt=Be(t,z,i,!1);if(e+=at,ot<8+at+ut)throw new x("code_w_scope total size is too short, truncating scope");if(ot>8+at+ut)throw new x("code_w_scope total size is too long, clips outer document");s?(R=o?Te(st,Ee,E):Te(st)).scope=lt:R=new Y(st,lt)}else{if(T!==ie)throw new x("Detected unknown BSON type ".concat(T.toString(16),' for fieldname "').concat(I,'"'));var ut;if((ut=t[e++]|t[e++]<<8|t[e++]<<16|t[e++]<<24)<=0||ut>t.length-e||0!==t[e+ut-1])throw new x("bad string length in bson");if(null!=d&&d.utf8&&!Se(t,e,e+ut-1))throw new x("Invalid UTF-8 string in BSON document");var ht=t.toString("utf8",e,e+ut-1);e+=ut;var ft=b.alloc(12);t.copy(ft,0,e,e+12),D=new mt(ft),e+=12,R=new H(ht,D)}"__proto__"===I?Object.defineProperty(E,I,{value:R,writable:!0,enumerable:!0,configurable:!0}):E[I]=R}if(k!==e-O){if(n)throw new x("corrupt array bson");throw new x("corrupt object bson")}if(!N)return E;if(J(E)){var ct=Object.assign({},E);return delete ct.$ref,delete ct.$id,delete ct.$db,new H(E.$ref,E.$id,E.$db,ct)}return E}function Te(t,e,i){return e?(null==e[t]&&(e[t]=new Function(t)),e[t].bind(i)):new Function(t)}function Ue(t,e,i,n){var r=t.toString("utf8",e,i);if(n)for(var s=0;s<r.length;s++)if(65533===r.charCodeAt(s)){if(!Se(t,e,i))throw new x("Invalid UTF-8 string in BSON document");break}return r}var je=/\x00/,Ie=new Set(["$db","$ref","$id","$clusterTime"]);function Re(t,e,i,n,r){t[n++]=Jt;var s=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8");t[(n=n+s+1)-1]=0;var o=t.write(i,n+4,void 0,"utf8");return t[n+3]=o+1>>24&255,t[n+2]=o+1>>16&255,t[n+1]=o+1>>8&255,t[n]=o+1&255,n=n+4+o,t[n++]=0,n}var De=new Uint8Array(8),Le=new DataView(De.buffer,De.byteOffset,De.byteLength);function Pe(t,e,i,n,r){return Number.isInteger(i)&&i>=$t&&i<=Mt?(t[n++]=oe,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,t[n++]=255&i,t[n++]=i>>8&255,t[n++]=i>>16&255,t[n++]=i>>24&255):(t[n++]=Yt,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,Le.setFloat64(0,i,!0),t.set(De,n),n+=8),n}function ze(t,e,i,n,r){return t[n++]=te,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,n}function Me(t,e,i,n,r){return t[n++]=Gt,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,t[n++]=i?1:0,n}function $e(t,e,i,n,r){t[n++]=Qt,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var s=tt.fromNumber(i.getTime()),o=s.getLowBits(),a=s.getHighBits();return t[n++]=255&o,t[n++]=o>>8&255,t[n++]=o>>16&255,t[n++]=o>>24&255,t[n++]=255&a,t[n++]=a>>8&255,t[n++]=a>>16&255,t[n++]=a>>24&255,n}function Ce(t,e,i,n,r){if(t[n++]=ee,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,i.source&&null!=i.source.match(je))throw Error("value "+i.source+" must not contain null bytes");return n+=t.write(i.source,n,void 0,"utf8"),t[n++]=0,i.ignoreCase&&(t[n++]=105),i.global&&(t[n++]=115),i.multiline&&(t[n++]=109),t[n++]=0,n}function Ke(t,e,i,n,r){if(t[n++]=ee,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,null!=i.pattern.match(je))throw Error("pattern "+i.pattern+" must not contain null bytes");return n+=t.write(i.pattern,n,void 0,"utf8"),t[n++]=0,n+=t.write(i.options.split("").sort().join(""),n,void 0,"utf8"),t[n++]=0,n}function Fe(t,e,i,n,r){return null===i?t[n++]=te:"MinKey"===i._bsontype?t[n++]=he:t[n++]=fe,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,n}function Ze(t,e,i,n,r){if(t[n++]=Wt,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,"string"==typeof i.id)t.write(i.id,n,void 0,"binary");else{if(!T(i.id))throw new S("object ["+JSON.stringify(i)+"] is not a valid ObjectId");t.set(i.id.subarray(0,12),n)}return n+12}function Ye(t,e,i,n,r){t[n++]=qt,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var s=i.length;return t[n++]=255&s,t[n++]=s>>8&255,t[n++]=s>>16&255,t[n++]=s>>24&255,t[n++]=ce,t.set(P(i),n),n+s}function Je(t,e,i,n,r,s,o,a,l,u){void 0===r&&(r=!1),void 0===s&&(s=0),void 0===o&&(o=!1),void 0===a&&(a=!0),void 0===l&&(l=!1),void 0===u&&(u=[]);for(var h=0;h<u.length;h++)if(u[h]===i)throw new x("cyclic dependency detected");u.push(i),t[n++]=Array.isArray(i)?Vt:Ht,n+=l?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var f=ii(t,i,r,n,s+1,o,a,u);return u.pop(),f}function He(t,e,i,n,r){return t[n++]=ue,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,t.set(i.bytes.subarray(0,16),n),n+16}function Ve(t,e,i,n,r){t[n++]="Long"===i._bsontype?le:ae,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var s=i.getLowBits(),o=i.getHighBits();return t[n++]=255&s,t[n++]=s>>8&255,t[n++]=s>>16&255,t[n++]=s>>24&255,t[n++]=255&o,t[n++]=o>>8&255,t[n++]=o>>16&255,t[n++]=o>>24&255,n}function qe(t,e,i,n,r){return i=i.valueOf(),t[n++]=oe,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,t[n++]=255&i,t[n++]=i>>8&255,t[n++]=i>>16&255,t[n++]=i>>24&255,n}function Xe(t,e,i,n,r){return t[n++]=Yt,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,Le.setFloat64(0,i.value,!0),t.set(De,n),n+8}function We(t,e,i,n,r,s,o){t[n++]=ne,n+=o?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var a=E(i),l=t.write(a,n+4,void 0,"utf8")+1;return t[n]=255&l,t[n+1]=l>>8&255,t[n+2]=l>>16&255,t[n+3]=l>>24&255,n=n+4+l-1,t[n++]=0,n}function Ge(t,e,i,n,r,s,o,a,l){if(void 0===r&&(r=!1),void 0===s&&(s=0),void 0===o&&(o=!1),void 0===a&&(a=!0),void 0===l&&(l=!1),i.scope&&"object"==typeof i.scope){t[n++]=se,n+=l?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var u=n,h="string"==typeof i.code?i.code:i.code.toString();n+=4;var f=t.write(h,n+4,void 0,"utf8")+1;t[n]=255&f,t[n+1]=f>>8&255,t[n+2]=f>>16&255,t[n+3]=f>>24&255,t[n+4+f-1]=0,n=n+f+4;var c=ii(t,i.scope,r,n,s+1,o,a);n=c-1;var d=c-u;t[u++]=255&d,t[u++]=d>>8&255,t[u++]=d>>16&255,t[u++]=d>>24&255,t[n++]=0}else{t[n++]=ne,n+=l?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0,h=i.code.toString();var p=t.write(h,n+4,void 0,"utf8")+1;t[n]=255&p,t[n+1]=p>>8&255,t[n+2]=p>>16&255,t[n+3]=p>>24&255,n=n+4+p-1,t[n++]=0}return n}function Qe(t,e,i,n,r){t[n++]=qt,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var s=i.value(!0),o=i.position;return i.sub_type===Z.SUBTYPE_BYTE_ARRAY&&(o+=4),t[n++]=255&o,t[n++]=o>>8&255,t[n++]=o>>16&255,t[n++]=o>>24&255,t[n++]=i.sub_type,i.sub_type===Z.SUBTYPE_BYTE_ARRAY&&(o-=4,t[n++]=255&o,t[n++]=o>>8&255,t[n++]=o>>16&255,t[n++]=o>>24&255),t.set(s,n),n+i.position}function ti(t,e,i,n,r){t[n++]=re,n+=r?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var s=t.write(i.value,n+4,void 0,"utf8")+1;return t[n]=255&s,t[n+1]=s>>8&255,t[n+2]=s>>16&255,t[n+3]=s>>24&255,n=n+4+s-1,t[n++]=0,n}function ei(t,e,i,n,r,s,o){t[n++]=Ht,n+=o?t.write(e,n,void 0,"ascii"):t.write(e,n,void 0,"utf8"),t[n++]=0;var a=n,l={$ref:i.collection||i.namespace,$id:i.oid};null!=i.db&&(l.$db=i.db);var u=ii(t,l=Object.assign(l,i.fields),!1,n,r+1,s),h=u-a;return t[a++]=255&h,t[a++]=h>>8&255,t[a++]=h>>16&255,t[a++]=h>>24&255,u}function ii(t,e,i,n,r,s,o,a){void 0===i&&(i=!1),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=!1),void 0===o&&(o=!0),void 0===a&&(a=[]),n=n||0,(a=a||[]).push(e);var l,u=n+4;if(Array.isArray(e))for(var h=0;h<e.length;h++){var f="".concat(h);if("function"==typeof(null==(g=e[h])?void 0:g.toBSON)&&(g=g.toBSON()),"string"==typeof g)u=Re(t,f,g,u,!0);else if("number"==typeof g)u=Pe(t,f,g,u,!0);else{if("bigint"==typeof g)throw new S("Unsupported type BigInt, please use Decimal128");if("boolean"==typeof g)u=Me(t,f,g,u,!0);else if(g instanceof Date||R(g))u=$e(t,f,g,u,!0);else if(void 0===g)u=ze(t,f,0,u,!0);else if(null===g)u=ze(t,f,0,u,!0);else if("ObjectId"===g._bsontype||"ObjectID"===g._bsontype)u=Ze(t,f,g,u,!0);else if(T(g))u=Ye(t,f,g,u,!0);else if(g instanceof RegExp||I(g))u=Ce(t,f,g,u,!0);else if("object"==typeof g&&null==g._bsontype)u=Je(t,f,g,u,i,r,s,o,!0,a);else if("object"==typeof g&&Et(g)&&"Decimal128"===g._bsontype)u=He(t,f,g,u,!0);else if("Long"===g._bsontype||"Timestamp"===g._bsontype)u=Ve(t,f,g,u,!0);else if("Double"===g._bsontype)u=Xe(t,f,g,u,!0);else if("function"==typeof g&&s)u=We(t,f,g,u,0,0,!0);else if("Code"===g._bsontype)u=Ge(t,f,g,u,i,r,s,o,!0);else if("Binary"===g._bsontype)u=Qe(t,f,g,u,!0);else if("Symbol"===g._bsontype)u=ti(t,f,g,u,!0);else if("DBRef"===g._bsontype)u=ei(t,f,g,u,r,s,!0);else if("BSONRegExp"===g._bsontype)u=Ke(t,f,g,u,!0);else if("Int32"===g._bsontype)u=qe(t,f,g,u,!0);else if("MinKey"===g._bsontype||"MaxKey"===g._bsontype)u=Fe(t,f,g,u,!0);else if(void 0!==g._bsontype)throw new S("Unrecognized or invalid _bsontype: ".concat(String(g._bsontype)))}}else if(e instanceof Lt||(l=e,"[object Map]"===Object.prototype.toString.call(l)))for(var c=e.entries(),d=!1;!d;){var p=c.next();if(!(d=!!p.done)){f=p.value[0];var y=typeof(g=p.value[1]);if("string"==typeof f&&!Ie.has(f)){if(null!=f.match(je))throw Error("key "+f+" must not contain null bytes");if(i){if("$"===f[0])throw Error("key "+f+" must not start with '$'");if(~f.indexOf("."))throw Error("key "+f+" must not contain '.'")}}if("string"===y)u=Re(t,f,g,u);else if("number"===y)u=Pe(t,f,g,u);else{if("bigint"===y||U(g)||j(g))throw new S("Unsupported type BigInt, please use Decimal128");if("boolean"===y)u=Me(t,f,g,u);else if(g instanceof Date||R(g))u=$e(t,f,g,u);else if(null===g||void 0===g&&!1===o)u=ze(t,f,0,u);else if("ObjectId"===g._bsontype||"ObjectID"===g._bsontype)u=Ze(t,f,g,u);else if(T(g))u=Ye(t,f,g,u);else if(g instanceof RegExp||I(g))u=Ce(t,f,g,u);else if("object"===y&&null==g._bsontype)u=Je(t,f,g,u,i,r,s,o,!1,a);else if("object"===y&&"Decimal128"===g._bsontype)u=He(t,f,g,u);else if("Long"===g._bsontype||"Timestamp"===g._bsontype)u=Ve(t,f,g,u);else if("Double"===g._bsontype)u=Xe(t,f,g,u);else if("Code"===g._bsontype)u=Ge(t,f,g,u,i,r,s,o);else if("function"==typeof g&&s)u=We(t,f,g,u,0,0,s);else if("Binary"===g._bsontype)u=Qe(t,f,g,u);else if("Symbol"===g._bsontype)u=ti(t,f,g,u);else if("DBRef"===g._bsontype)u=ei(t,f,g,u,r,s);else if("BSONRegExp"===g._bsontype)u=Ke(t,f,g,u);else if("Int32"===g._bsontype)u=qe(t,f,g,u);else if("MinKey"===g._bsontype||"MaxKey"===g._bsontype)u=Fe(t,f,g,u);else if(void 0!==g._bsontype)throw new S("Unrecognized or invalid _bsontype: ".concat(String(g._bsontype)))}}}else{if("function"==typeof(null==e?void 0:e.toBSON)&&null!=(e=e.toBSON())&&"object"!=typeof e)throw new S("toBSON function did not return an object");for(var f in e){var g;if("function"==typeof(null==(g=e[f])?void 0:g.toBSON)&&(g=g.toBSON()),y=typeof g,"string"==typeof f&&!Ie.has(f)){if(null!=f.match(je))throw Error("key "+f+" must not contain null bytes");if(i){if("$"===f[0])throw Error("key "+f+" must not start with '$'");if(~f.indexOf("."))throw Error("key "+f+" must not contain '.'")}}if("string"===y)u=Re(t,f,g,u);else if("number"===y)u=Pe(t,f,g,u);else{if("bigint"===y)throw new S("Unsupported type BigInt, please use Decimal128");if("boolean"===y)u=Me(t,f,g,u);else if(g instanceof Date||R(g))u=$e(t,f,g,u);else if(void 0===g)!1===o&&(u=ze(t,f,0,u));else if(null===g)u=ze(t,f,0,u);else if("ObjectId"===g._bsontype||"ObjectID"===g._bsontype)u=Ze(t,f,g,u);else if(T(g))u=Ye(t,f,g,u);else if(g instanceof RegExp||I(g))u=Ce(t,f,g,u);else if("object"===y&&null==g._bsontype)u=Je(t,f,g,u,i,r,s,o,!1,a);else if("object"===y&&"Decimal128"===g._bsontype)u=He(t,f,g,u);else if("Long"===g._bsontype||"Timestamp"===g._bsontype)u=Ve(t,f,g,u);else if("Double"===g._bsontype)u=Xe(t,f,g,u);else if("Code"===g._bsontype)u=Ge(t,f,g,u,i,r,s,o);else if("function"==typeof g&&s)u=We(t,f,g,u,0,0,s);else if("Binary"===g._bsontype)u=Qe(t,f,g,u);else if("Symbol"===g._bsontype)u=ti(t,f,g,u);else if("DBRef"===g._bsontype)u=ei(t,f,g,u,r,s);else if("BSONRegExp"===g._bsontype)u=Ke(t,f,g,u);else if("Int32"===g._bsontype)u=qe(t,f,g,u);else if("MinKey"===g._bsontype||"MaxKey"===g._bsontype)u=Fe(t,f,g,u);else if(void 0!==g._bsontype)throw new S("Unrecognized or invalid _bsontype: ".concat(String(g._bsontype)))}}}a.pop(),t[u++]=0;var _=u-n;return t[n++]=255&_,t[n++]=_>>8&255,t[n++]=_>>16&255,t[n++]=_>>24&255,u}var ni=17825792,ri=b.alloc(ni);function si(t){ri.length<t&&(ri=b.alloc(t))}function oi(t,e){void 0===e&&(e={});var i="boolean"==typeof e.checkKeys&&e.checkKeys,n="boolean"==typeof e.serializeFunctions&&e.serializeFunctions,r="boolean"!=typeof e.ignoreUndefined||e.ignoreUndefined,s="number"==typeof e.minInternalBufferSize?e.minInternalBufferSize:ni;ri.length<s&&(ri=b.alloc(s));var o=ii(ri,t,i,0,0,n,r,[]),a=b.alloc(o);return ri.copy(a,0,0,a.length),a}function ai(t,e,i){void 0===i&&(i={});var n="boolean"==typeof i.checkKeys&&i.checkKeys,r="boolean"==typeof i.serializeFunctions&&i.serializeFunctions,s="boolean"!=typeof i.ignoreUndefined||i.ignoreUndefined,o="number"==typeof i.index?i.index:0,a=ii(ri,t,n,0,0,r,s);return ri.copy(e,o,0,a),o+a-1}function li(t,e){return void 0===e&&(e={}),Ae(t instanceof b?t:P(t),e)}function ui(t,e){return void 0===e&&(e={}),me(t,"boolean"==typeof(e=e||{}).serializeFunctions&&e.serializeFunctions,"boolean"!=typeof e.ignoreUndefined||e.ignoreUndefined)}function hi(t,e,i,n,r,s){for(var o=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},s),a=P(t),l=e,u=0;u<i;u++){var h=a[l]|a[l+1]<<8|a[l+2]<<16|a[l+3]<<24;o.index=l,n[r+u]=Ae(a,o),l+=h}return l}const fi={Binary:Z,Code:Y,DBRef:H,Decimal128:dt,Double:pt,Int32:yt,Long:tt,UUID:F,Map:Lt,MaxKey:gt,MinKey:_t,ObjectId:mt,ObjectID:mt,BSONRegExp:xt,BSONSymbol:St,Timestamp:kt,EJSON:Dt,setInternalBufferSize:si,serialize:oi,serializeWithBufferAndIndex:ai,deserialize:li,calculateObjectSize:ui,deserializeStream:hi,BSONError:x,BSONTypeError:S}},706:t=>{!function(){"use strict";t.exports=function(t){return(t instanceof Buffer?t:Buffer.from(t.toString(),"binary")).toString("base64")}}()},591:(t,e,i)=>{"use strict";const{Deflate:n,deflate:r,deflateRaw:s,gzip:o}=i(555),{Inflate:a,inflate:l,inflateRaw:u,ungzip:h}=i(843),f=i(619);t.exports.Deflate=n,t.exports.deflate=r,t.exports.deflateRaw=s,t.exports.gzip=o,t.exports.Inflate=a,t.exports.inflate=l,t.exports.inflateRaw=u,t.exports.ungzip=h,t.exports.constants=f},555:(t,e,i)=>{"use strict";const n=i(405),r=i(236),s=i(373),o=i(898),a=i(292),l=Object.prototype.toString,{Z_NO_FLUSH:u,Z_SYNC_FLUSH:h,Z_FULL_FLUSH:f,Z_FINISH:c,Z_OK:d,Z_STREAM_END:p,Z_DEFAULT_COMPRESSION:y,Z_DEFAULT_STRATEGY:g,Z_DEFLATED:_}=i(619);function b(t){this.options=r.assign({level:y,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:g},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let i=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==d)throw new Error(o[i]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?s.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=n.deflateSetDictionary(this.strm,t),i!==d)throw new Error(o[i]);this._dict_set=!0}}function w(t,e){const i=new b(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}b.prototype.push=function(t,e){const i=this.strm,r=this.options.chunkSize;let o,a;if(this.ended)return!1;for(a=e===~~e?e:!0===e?c:u,"string"==typeof t?i.input=s.string2buf(t):"[object ArrayBuffer]"===l.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),(a===h||a===f)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(o=n.deflate(i,a),o===p)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),o=n.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===d;if(0!==i.avail_out){if(a>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},b.prototype.onData=function(t){this.chunks.push(t)},b.prototype.onEnd=function(t){t===d&&(this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},t.exports.Deflate=b,t.exports.deflate=w,t.exports.deflateRaw=function(t,e){return(e=e||{}).raw=!0,w(t,e)},t.exports.gzip=function(t,e){return(e=e||{}).gzip=!0,w(t,e)},t.exports.constants=i(619)},843:(t,e,i)=>{"use strict";const n=i(948),r=i(236),s=i(373),o=i(898),a=i(292),l=i(401),u=Object.prototype.toString,{Z_NO_FLUSH:h,Z_FINISH:f,Z_OK:c,Z_STREAM_END:d,Z_NEED_DICT:p,Z_STREAM_ERROR:y,Z_DATA_ERROR:g,Z_MEM_ERROR:_}=i(619);function b(t){this.options=r.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;let i=n.inflateInit2(this.strm,e.windowBits);if(i!==c)throw new Error(o[i]);if(this.header=new l,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=s.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(i=n.inflateSetDictionary(this.strm,e.dictionary),i!==c)))throw new Error(o[i])}function w(t,e){const i=new b(e);if(i.push(t),i.err)throw i.msg||o[i.err];return i.result}b.prototype.push=function(t,e){const i=this.strm,r=this.options.chunkSize,o=this.options.dictionary;let a,l,b;if(this.ended)return!1;for(l=e===~~e?e:!0===e?f:h,"[object ArrayBuffer]"===u.call(t)?i.input=new Uint8Array(t):i.input=t,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(r),i.next_out=0,i.avail_out=r),a=n.inflate(i,l),a===p&&o&&(a=n.inflateSetDictionary(i,o),a===c?a=n.inflate(i,l):a===g&&(a=p));i.avail_in>0&&a===d&&i.state.wrap>0&&0!==t[i.next_in];)n.inflateReset(i),a=n.inflate(i,l);switch(a){case y:case g:case p:case _:return this.onEnd(a),this.ended=!0,!1}if(b=i.avail_out,i.next_out&&(0===i.avail_out||a===d))if("string"===this.options.to){let t=s.utf8border(i.output,i.next_out),e=i.next_out-t,n=s.buf2string(i.output,t);i.next_out=e,i.avail_out=r-e,e&&i.output.set(i.output.subarray(t,t+e),0),this.onData(n)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(a!==c||0!==b){if(a===d)return a=n.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},b.prototype.onData=function(t){this.chunks.push(t)},b.prototype.onEnd=function(t){t===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},t.exports.Inflate=b,t.exports.inflate=w,t.exports.inflateRaw=function(t,e){return(e=e||{}).raw=!0,w(t,e)},t.exports.ungzip=w,t.exports.constants=i(619)},236:t=>{"use strict";const e=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);t.exports.assign=function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const n=i.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const i in n)e(n,i)&&(t[i]=n[i])}}return t},t.exports.flattenChunks=t=>{let e=0;for(let i=0,n=t.length;i<n;i++)e+=t[i].length;const i=new Uint8Array(e);for(let e=0,n=0,r=t.length;e<r;e++){let r=t[e];i.set(r,n),n+=r.length}return i}},373:t=>{"use strict";let e=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){e=!1}const i=new Uint8Array(256);for(let t=0;t<256;t++)i[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;i[254]=i[254]=1,t.exports.string2buf=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,i,n,r,s,o=t.length,a=0;for(r=0;r<o;r++)i=t.charCodeAt(r),55296==(64512&i)&&r+1<o&&(n=t.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),a+=i<128?1:i<2048?2:i<65536?3:4;for(e=new Uint8Array(a),s=0,r=0;s<a;r++)i=t.charCodeAt(r),55296==(64512&i)&&r+1<o&&(n=t.charCodeAt(r+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},t.exports.buf2string=(t,n)=>{const r=n||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,n));let s,o;const a=new Array(2*r);for(o=0,s=0;s<r;){let e=t[s++];if(e<128){a[o++]=e;continue}let n=i[e];if(n>4)a[o++]=65533,s+=n-1;else{for(e&=2===n?31:3===n?15:7;n>1&&s<r;)e=e<<6|63&t[s++],n--;n>1?a[o++]=65533:e<65536?a[o++]=e:(e-=65536,a[o++]=55296|e>>10&1023,a[o++]=56320|1023&e)}}return((t,i)=>{if(i<65534&&t.subarray&&e)return String.fromCharCode.apply(null,t.length===i?t:t.subarray(0,i));let n="";for(let e=0;e<i;e++)n+=String.fromCharCode(t[e]);return n})(a,o)},t.exports.utf8border=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+i[t[n]]>e?n:e}},69:t=>{"use strict";t.exports=(t,e,i,n)=>{let r=65535&t|0,s=t>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{r=r+e[n++]|0,s=s+r|0}while(--o);r%=65521,s%=65521}return r|s<<16|0}},619:t=>{"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},869:t=>{"use strict";const e=new Uint32Array((()=>{let t,e=[];for(var i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e})());t.exports=(t,i,n,r)=>{const s=e,o=r+n;t^=-1;for(let e=r;e<o;e++)t=t>>>8^s[255&(t^i[e])];return-1^t}},405:(t,e,i)=>{"use strict";const{_tr_init:n,_tr_stored_block:r,_tr_flush_block:s,_tr_tally:o,_tr_align:a}=i(342),l=i(69),u=i(869),h=i(898),{Z_NO_FLUSH:f,Z_PARTIAL_FLUSH:c,Z_FULL_FLUSH:d,Z_FINISH:p,Z_BLOCK:y,Z_OK:g,Z_STREAM_END:_,Z_STREAM_ERROR:b,Z_DATA_ERROR:w,Z_BUF_ERROR:v,Z_DEFAULT_COMPRESSION:m,Z_FILTERED:x,Z_HUFFMAN_ONLY:S,Z_RLE:O,Z_FIXED:k,Z_DEFAULT_STRATEGY:E,Z_UNKNOWN:A,Z_DEFLATED:N}=i(619),B=258,T=262,U=42,j=113,I=666,R=(t,e)=>(t.msg=h[e],e),D=t=>2*t-(t>4?9:0),L=t=>{let e=t.length;for(;--e>=0;)t[e]=0},P=t=>{let e,i,n,r=t.w_size;e=t.hash_size,n=e;do{i=t.head[--n],t.head[n]=i>=r?i-r:0}while(--e);e=r,n=e;do{i=t.prev[--n],t.prev[n]=i>=r?i-r:0}while(--e)};let z=(t,e,i)=>(e<<t.hash_shift^i)&t.hash_mask;const M=t=>{const e=t.state;let i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+i),t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))},$=(t,e)=>{s(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,M(t.strm)},C=(t,e)=>{t.pending_buf[t.pending++]=e},K=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},F=(t,e,i,n)=>{let r=t.avail_in;return r>n&&(r=n),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),i),1===t.state.wrap?t.adler=l(t.adler,e,r,i):2===t.state.wrap&&(t.adler=u(t.adler,e,r,i)),t.next_in+=r,t.total_in+=r,r)},Z=(t,e)=>{let i,n,r=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const l=t.strstart>t.w_size-T?t.strstart-(t.w_size-T):0,u=t.window,h=t.w_mask,f=t.prev,c=t.strstart+B;let d=u[s+o-1],p=u[s+o];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do{if(i=e,u[i+o]===p&&u[i+o-1]===d&&u[i]===u[s]&&u[++i]===u[s+1]){s+=2,i++;do{}while(u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&u[++s]===u[++i]&&s<c);if(n=B-(c-s),s=c-B,n>o){if(t.match_start=e,o=n,n>=a)break;d=u[s+o-1],p=u[s+o]}}}while((e=f[e&h])>l&&0!=--r);return o<=t.lookahead?o:t.lookahead},Y=t=>{const e=t.w_size;let i,n,r;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-T)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),P(t),n+=e),0===t.strm.avail_in)break;if(i=F(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=i,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=z(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=z(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<T&&0!==t.strm.avail_in)},J=(t,e)=>{let i,n,s,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,a=0,l=t.strm.avail_in;do{if(i=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s)break;if(s=t.strm.avail_out-s,n=t.strstart-t.block_start,i>n+t.strm.avail_in&&(i=n+t.strm.avail_in),i>s&&(i=s),i<o&&(0===i&&e!==p||e===f||i!==n+t.strm.avail_in))break;a=e===p&&i===n+t.strm.avail_in?1:0,r(t,0,0,a),t.pending_buf[t.pending-4]=i,t.pending_buf[t.pending-3]=i>>8,t.pending_buf[t.pending-2]=~i,t.pending_buf[t.pending-1]=~i>>8,M(t.strm),n&&(n>i&&(n=i),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,i-=n),i&&(F(t.strm,t.strm.output,t.strm.next_out,i),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i)}while(0===a);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),a?4:e!==f&&e!==p&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(F(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,o=s>t.w_size?t.w_size:s,n=t.strstart-t.block_start,(n>=o||(n||e===p)&&e!==f&&0===t.strm.avail_in&&n<=s)&&(i=n>s?s:n,a=e===p&&0===t.strm.avail_in&&i===n?1:0,r(t,t.block_start,i,a),t.block_start+=i,M(t.strm)),a?3:1)},H=(t,e)=>{let i,n;for(;;){if(t.lookahead<T){if(Y(t),t.lookahead<T&&e===f)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=z(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-T&&(t.match_length=Z(t,i)),t.match_length>=3)if(n=o(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=z(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=z(t,t.ins_h,t.window[t.strstart+1]);else n=o(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&($(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===p?($(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&($(t,!1),0===t.strm.avail_out)?1:2},V=(t,e)=>{let i,n,r;for(;;){if(t.lookahead<T){if(Y(t),t.lookahead<T&&e===f)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=z(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-T&&(t.match_length=Z(t,i),t.match_length<=5&&(t.strategy===x||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,n=o(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=z(t,t.ins_h,t.window[t.strstart+3-1]),i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&($(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=o(t,0,t.window[t.strstart-1]),n&&$(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=o(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===p?($(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&($(t,!1),0===t.strm.avail_out)?1:2};function q(t,e,i,n,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=r}const X=[new q(0,0,0,0,J),new q(4,4,8,4,H),new q(4,5,16,8,H),new q(4,6,32,32,H),new q(4,4,16,16,V),new q(8,16,32,32,V),new q(8,16,128,128,V),new q(8,32,128,256,V),new q(32,128,258,1024,V),new q(32,258,258,4096,V)];function W(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=N,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),L(this.dyn_ltree),L(this.dyn_dtree),L(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),L(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),L(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const G=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==U&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==j&&e.status!==I?1:0},Q=t=>{if(G(t))return R(t,b);t.total_in=t.total_out=0,t.data_type=A;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?U:j,t.adler=2===e.wrap?0:1,e.last_flush=-2,n(e),g},tt=t=>{const e=Q(t);var i;return e===g&&((i=t.state).window_size=2*i.w_size,L(i.head),i.max_lazy_match=X[i.level].max_lazy,i.good_match=X[i.level].good_length,i.nice_match=X[i.level].nice_length,i.max_chain_length=X[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),e},et=(t,e,i,n,r,s)=>{if(!t)return b;let o=1;if(e===m&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),r<1||r>9||i!==N||n<8||n>15||e<0||e>9||s<0||s>k||8===n&&1!==o)return R(t,b);8===n&&(n=9);const a=new W;return t.state=a,a.strm=t,a.status=U,a.wrap=o,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=s,a.method=i,tt(t)};t.exports.deflateInit=(t,e)=>et(t,e,N,15,8,E),t.exports.deflateInit2=et,t.exports.deflateReset=tt,t.exports.deflateResetKeep=Q,t.exports.deflateSetHeader=(t,e)=>G(t)||2!==t.state.wrap?b:(t.state.gzhead=e,g),t.exports.deflate=(t,e)=>{if(G(t)||e>y||e<0)return t?R(t,b):b;const i=t.state;if(!t.output||0!==t.avail_in&&!t.input||i.status===I&&e!==p)return R(t,0===t.avail_out?v:b);const n=i.last_flush;if(i.last_flush=e,0!==i.pending){if(M(t),0===t.avail_out)return i.last_flush=-1,g}else if(0===t.avail_in&&D(e)<=D(n)&&e!==p)return R(t,v);if(i.status===I&&0!==t.avail_in)return R(t,v);if(i.status===U&&0===i.wrap&&(i.status=j),i.status===U){let e=N+(i.w_bits-8<<4)<<8,n=-1;if(n=i.strategy>=S||i.level<2?0:i.level<6?1:6===i.level?2:3,e|=n<<6,0!==i.strstart&&(e|=32),e+=31-e%31,K(i,e),0!==i.strstart&&(K(i,t.adler>>>16),K(i,65535&t.adler)),t.adler=1,i.status=j,M(t),0!==i.pending)return i.last_flush=-1,g}if(57===i.status)if(t.adler=0,C(i,31),C(i,139),C(i,8),i.gzhead)C(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),C(i,255&i.gzhead.time),C(i,i.gzhead.time>>8&255),C(i,i.gzhead.time>>16&255),C(i,i.gzhead.time>>24&255),C(i,9===i.level?2:i.strategy>=S||i.level<2?4:0),C(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(C(i,255&i.gzhead.extra.length),C(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=u(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(C(i,0),C(i,0),C(i,0),C(i,0),C(i,0),C(i,9===i.level?2:i.strategy>=S||i.level<2?4:0),C(i,3),i.status=j,M(t),0!==i.pending)return i.last_flush=-1,g;if(69===i.status){if(i.gzhead.extra){let e=i.pending,n=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+n>i.pending_buf_size;){let r=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+r),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>e&&(t.adler=u(t.adler,i.pending_buf,i.pending-e,e)),i.gzindex+=r,M(t),0!==i.pending)return i.last_flush=-1,g;e=0,n-=r}let r=new Uint8Array(i.gzhead.extra);i.pending_buf.set(r.subarray(i.gzindex,i.gzindex+n),i.pending),i.pending+=n,i.gzhead.hcrc&&i.pending>e&&(t.adler=u(t.adler,i.pending_buf,i.pending-e,e)),i.gzindex=0}i.status=73}if(73===i.status){if(i.gzhead.name){let e,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(t.adler=u(t.adler,i.pending_buf,i.pending-n,n)),M(t),0!==i.pending)return i.last_flush=-1,g;n=0}e=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,C(i,e)}while(0!==e);i.gzhead.hcrc&&i.pending>n&&(t.adler=u(t.adler,i.pending_buf,i.pending-n,n)),i.gzindex=0}i.status=91}if(91===i.status){if(i.gzhead.comment){let e,n=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>n&&(t.adler=u(t.adler,i.pending_buf,i.pending-n,n)),M(t),0!==i.pending)return i.last_flush=-1,g;n=0}e=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,C(i,e)}while(0!==e);i.gzhead.hcrc&&i.pending>n&&(t.adler=u(t.adler,i.pending_buf,i.pending-n,n))}i.status=103}if(103===i.status){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(M(t),0!==i.pending))return i.last_flush=-1,g;C(i,255&t.adler),C(i,t.adler>>8&255),t.adler=0}if(i.status=j,M(t),0!==i.pending)return i.last_flush=-1,g}if(0!==t.avail_in||0!==i.lookahead||e!==f&&i.status!==I){let n=0===i.level?J(i,e):i.strategy===S?((t,e)=>{let i;for(;;){if(0===t.lookahead&&(Y(t),0===t.lookahead)){if(e===f)return 1;break}if(t.match_length=0,i=o(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&($(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===p?($(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&($(t,!1),0===t.strm.avail_out)?1:2})(i,e):i.strategy===O?((t,e)=>{let i,n,r,s;const a=t.window;for(;;){if(t.lookahead<=B){if(Y(t),t.lookahead<=B&&e===f)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=t.strstart-1,n=a[r],n===a[++r]&&n===a[++r]&&n===a[++r])){s=t.strstart+B;do{}while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<s);t.match_length=B-(s-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=o(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=o(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&($(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===p?($(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&($(t,!1),0===t.strm.avail_out)?1:2})(i,e):X[i.level].func(i,e);if(3!==n&&4!==n||(i.status=I),1===n||3===n)return 0===t.avail_out&&(i.last_flush=-1),g;if(2===n&&(e===c?a(i):e!==y&&(r(i,0,0,!1),e===d&&(L(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),M(t),0===t.avail_out))return i.last_flush=-1,g}return e!==p?g:i.wrap<=0?_:(2===i.wrap?(C(i,255&t.adler),C(i,t.adler>>8&255),C(i,t.adler>>16&255),C(i,t.adler>>24&255),C(i,255&t.total_in),C(i,t.total_in>>8&255),C(i,t.total_in>>16&255),C(i,t.total_in>>24&255)):(K(i,t.adler>>>16),K(i,65535&t.adler)),M(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?g:_)},t.exports.deflateEnd=t=>{if(G(t))return b;const e=t.state.status;return t.state=null,e===j?R(t,w):g},t.exports.deflateSetDictionary=(t,e)=>{let i=e.length;if(G(t))return b;const n=t.state,r=n.wrap;if(2===r||1===r&&n.status!==U||n.lookahead)return b;if(1===r&&(t.adler=l(t.adler,e,i,0)),n.wrap=0,i>=n.w_size){0===r&&(L(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(i-n.w_size,i),0),e=t,i=n.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=i,t.next_in=0,t.input=e,Y(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=z(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,Y(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,n.wrap=r,g},t.exports.deflateInfo="pako deflate (from Nodeca project)"},401:t=>{"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},264:t=>{"use strict";const e=16209;t.exports=function(t,i){let n,r,s,o,a,l,u,h,f,c,d,p,y,g,_,b,w,v,m,x,S,O,k,E;const A=t.state;n=t.next_in,k=t.input,r=n+(t.avail_in-5),s=t.next_out,E=t.output,o=s-(i-t.avail_out),a=s+(t.avail_out-257),l=A.dmax,u=A.wsize,h=A.whave,f=A.wnext,c=A.window,d=A.hold,p=A.bits,y=A.lencode,g=A.distcode,_=(1<<A.lenbits)-1,b=(1<<A.distbits)-1;t:do{p<15&&(d+=k[n++]<<p,p+=8,d+=k[n++]<<p,p+=8),w=y[d&_];e:for(;;){if(v=w>>>24,d>>>=v,p-=v,v=w>>>16&255,0===v)E[s++]=65535&w;else{if(!(16&v)){if(0==(64&v)){w=y[(65535&w)+(d&(1<<v)-1)];continue e}if(32&v){A.mode=16191;break t}t.msg="invalid literal/length code",A.mode=e;break t}m=65535&w,v&=15,v&&(p<v&&(d+=k[n++]<<p,p+=8),m+=d&(1<<v)-1,d>>>=v,p-=v),p<15&&(d+=k[n++]<<p,p+=8,d+=k[n++]<<p,p+=8),w=g[d&b];i:for(;;){if(v=w>>>24,d>>>=v,p-=v,v=w>>>16&255,!(16&v)){if(0==(64&v)){w=g[(65535&w)+(d&(1<<v)-1)];continue i}t.msg="invalid distance code",A.mode=e;break t}if(x=65535&w,v&=15,p<v&&(d+=k[n++]<<p,p+=8,p<v&&(d+=k[n++]<<p,p+=8)),x+=d&(1<<v)-1,x>l){t.msg="invalid distance too far back",A.mode=e;break t}if(d>>>=v,p-=v,v=s-o,x>v){if(v=x-v,v>h&&A.sane){t.msg="invalid distance too far back",A.mode=e;break t}if(S=0,O=c,0===f){if(S+=u-v,v<m){m-=v;do{E[s++]=c[S++]}while(--v);S=s-x,O=E}}else if(f<v){if(S+=u+f-v,v-=f,v<m){m-=v;do{E[s++]=c[S++]}while(--v);if(S=0,f<m){v=f,m-=v;do{E[s++]=c[S++]}while(--v);S=s-x,O=E}}}else if(S+=f-v,v<m){m-=v;do{E[s++]=c[S++]}while(--v);S=s-x,O=E}for(;m>2;)E[s++]=O[S++],E[s++]=O[S++],E[s++]=O[S++],m-=3;m&&(E[s++]=O[S++],m>1&&(E[s++]=O[S++]))}else{S=s-x;do{E[s++]=E[S++],E[s++]=E[S++],E[s++]=E[S++],m-=3}while(m>2);m&&(E[s++]=E[S++],m>1&&(E[s++]=E[S++]))}break}}break}}while(n<r&&s<a);m=p>>3,n-=m,p-=m<<3,d&=(1<<p)-1,t.next_in=n,t.next_out=s,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=s<a?a-s+257:257-(s-a),A.hold=d,A.bits=p}},948:(t,e,i)=>{"use strict";const n=i(69),r=i(869),s=i(264),o=i(241),{Z_FINISH:a,Z_BLOCK:l,Z_TREES:u,Z_OK:h,Z_STREAM_END:f,Z_NEED_DICT:c,Z_STREAM_ERROR:d,Z_DATA_ERROR:p,Z_MEM_ERROR:y,Z_BUF_ERROR:g,Z_DEFLATED:_}=i(619),b=16180,w=16190,v=16191,m=16192,x=16194,S=16199,O=16200,k=16206,E=16209,A=16210,N=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function B(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const T=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<b||e.mode>16211?1:0},U=t=>{if(T(t))return d;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=b,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,h},j=t=>{if(T(t))return d;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,U(t)},I=(t,e)=>{let i;if(T(t))return d;const n=t.state;return e<0?(i=0,e=-e):(i=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?d:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,j(t))},R=(t,e)=>{if(!t)return d;const i=new B;t.state=i,i.strm=t,i.window=null,i.mode=b;const n=I(t,e);return n!==h&&(t.state=null),n};let D,L,P=!0;const z=t=>{if(P){D=new Int32Array(512),L=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(1,t.lens,0,288,D,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(2,t.lens,0,32,L,0,t.work,{bits:5}),P=!1}t.lencode=D,t.lenbits=9,t.distcode=L,t.distbits=5},M=(t,e,i,n)=>{let r;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>n&&(r=n),s.window.set(e.subarray(i-n,i-n+r),s.wnext),(n-=r)?(s.window.set(e.subarray(i-n,i),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};t.exports.inflateReset=j,t.exports.inflateReset2=I,t.exports.inflateResetKeep=U,t.exports.inflateInit=t=>R(t,15),t.exports.inflateInit2=R,t.exports.inflate=(t,e)=>{let i,B,U,j,I,R,D,L,P,$,C,K,F,Z,Y,J,H,V,q,X,W,G,Q=0;const tt=new Uint8Array(4);let et,it;const nt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(T(t)||!t.output||!t.input&&0!==t.avail_in)return d;i=t.state,i.mode===v&&(i.mode=m),I=t.next_out,U=t.output,D=t.avail_out,j=t.next_in,B=t.input,R=t.avail_in,L=i.hold,P=i.bits,$=R,C=D,G=h;t:for(;;)switch(i.mode){case b:if(0===i.wrap){i.mode=m;break}for(;P<16;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(2&i.wrap&&35615===L){0===i.wbits&&(i.wbits=15),i.check=0,tt[0]=255&L,tt[1]=L>>>8&255,i.check=r(i.check,tt,2,0),L=0,P=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&L)<<8)+(L>>8))%31){t.msg="incorrect header check",i.mode=E;break}if((15&L)!==_){t.msg="unknown compression method",i.mode=E;break}if(L>>>=4,P-=4,W=8+(15&L),0===i.wbits&&(i.wbits=W),W>15||W>i.wbits){t.msg="invalid window size",i.mode=E;break}i.dmax=1<<i.wbits,i.flags=0,t.adler=i.check=1,i.mode=512&L?16189:v,L=0,P=0;break;case 16181:for(;P<16;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(i.flags=L,(255&i.flags)!==_){t.msg="unknown compression method",i.mode=E;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=E;break}i.head&&(i.head.text=L>>8&1),512&i.flags&&4&i.wrap&&(tt[0]=255&L,tt[1]=L>>>8&255,i.check=r(i.check,tt,2,0)),L=0,P=0,i.mode=16182;case 16182:for(;P<32;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}i.head&&(i.head.time=L),512&i.flags&&4&i.wrap&&(tt[0]=255&L,tt[1]=L>>>8&255,tt[2]=L>>>16&255,tt[3]=L>>>24&255,i.check=r(i.check,tt,4,0)),L=0,P=0,i.mode=16183;case 16183:for(;P<16;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}i.head&&(i.head.xflags=255&L,i.head.os=L>>8),512&i.flags&&4&i.wrap&&(tt[0]=255&L,tt[1]=L>>>8&255,i.check=r(i.check,tt,2,0)),L=0,P=0,i.mode=16184;case 16184:if(1024&i.flags){for(;P<16;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}i.length=L,i.head&&(i.head.extra_len=L),512&i.flags&&4&i.wrap&&(tt[0]=255&L,tt[1]=L>>>8&255,i.check=r(i.check,tt,2,0)),L=0,P=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&i.flags&&(K=i.length,K>R&&(K=R),K&&(i.head&&(W=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(B.subarray(j,j+K),W)),512&i.flags&&4&i.wrap&&(i.check=r(i.check,B,K,j)),R-=K,j+=K,i.length-=K),i.length))break t;i.length=0,i.mode=16186;case 16186:if(2048&i.flags){if(0===R)break t;K=0;do{W=B[j+K++],i.head&&W&&i.length<65536&&(i.head.name+=String.fromCharCode(W))}while(W&&K<R);if(512&i.flags&&4&i.wrap&&(i.check=r(i.check,B,K,j)),R-=K,j+=K,W)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&i.flags){if(0===R)break t;K=0;do{W=B[j+K++],i.head&&W&&i.length<65536&&(i.head.comment+=String.fromCharCode(W))}while(W&&K<R);if(512&i.flags&&4&i.wrap&&(i.check=r(i.check,B,K,j)),R-=K,j+=K,W)break t}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&i.flags){for(;P<16;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(4&i.wrap&&L!==(65535&i.check)){t.msg="header crc mismatch",i.mode=E;break}L=0,P=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=v;break;case 16189:for(;P<32;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}t.adler=i.check=N(L),L=0,P=0,i.mode=w;case w:if(0===i.havedict)return t.next_out=I,t.avail_out=D,t.next_in=j,t.avail_in=R,i.hold=L,i.bits=P,c;t.adler=i.check=1,i.mode=v;case v:if(e===l||e===u)break t;case m:if(i.last){L>>>=7&P,P-=7&P,i.mode=k;break}for(;P<3;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}switch(i.last=1&L,L>>>=1,P-=1,3&L){case 0:i.mode=16193;break;case 1:if(z(i),i.mode=S,e===u){L>>>=2,P-=2;break t}break;case 2:i.mode=16196;break;case 3:t.msg="invalid block type",i.mode=E}L>>>=2,P-=2;break;case 16193:for(L>>>=7&P,P-=7&P;P<32;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if((65535&L)!=(L>>>16^65535)){t.msg="invalid stored block lengths",i.mode=E;break}if(i.length=65535&L,L=0,P=0,i.mode=x,e===u)break t;case x:i.mode=16195;case 16195:if(K=i.length,K){if(K>R&&(K=R),K>D&&(K=D),0===K)break t;U.set(B.subarray(j,j+K),I),R-=K,j+=K,D-=K,I+=K,i.length-=K;break}i.mode=v;break;case 16196:for(;P<14;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(i.nlen=257+(31&L),L>>>=5,P-=5,i.ndist=1+(31&L),L>>>=5,P-=5,i.ncode=4+(15&L),L>>>=4,P-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=E;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;P<3;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}i.lens[nt[i.have++]]=7&L,L>>>=3,P-=3}for(;i.have<19;)i.lens[nt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,et={bits:i.lenbits},G=o(0,i.lens,0,19,i.lencode,0,i.work,et),i.lenbits=et.bits,G){t.msg="invalid code lengths set",i.mode=E;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Q=i.lencode[L&(1<<i.lenbits)-1],Y=Q>>>24,J=Q>>>16&255,H=65535&Q,!(Y<=P);){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(H<16)L>>>=Y,P-=Y,i.lens[i.have++]=H;else{if(16===H){for(it=Y+2;P<it;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(L>>>=Y,P-=Y,0===i.have){t.msg="invalid bit length repeat",i.mode=E;break}W=i.lens[i.have-1],K=3+(3&L),L>>>=2,P-=2}else if(17===H){for(it=Y+3;P<it;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}L>>>=Y,P-=Y,W=0,K=3+(7&L),L>>>=3,P-=3}else{for(it=Y+7;P<it;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}L>>>=Y,P-=Y,W=0,K=11+(127&L),L>>>=7,P-=7}if(i.have+K>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=E;break}for(;K--;)i.lens[i.have++]=W}}if(i.mode===E)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=E;break}if(i.lenbits=9,et={bits:i.lenbits},G=o(1,i.lens,0,i.nlen,i.lencode,0,i.work,et),i.lenbits=et.bits,G){t.msg="invalid literal/lengths set",i.mode=E;break}if(i.distbits=6,i.distcode=i.distdyn,et={bits:i.distbits},G=o(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,et),i.distbits=et.bits,G){t.msg="invalid distances set",i.mode=E;break}if(i.mode=S,e===u)break t;case S:i.mode=O;case O:if(R>=6&&D>=258){t.next_out=I,t.avail_out=D,t.next_in=j,t.avail_in=R,i.hold=L,i.bits=P,s(t,C),I=t.next_out,U=t.output,D=t.avail_out,j=t.next_in,B=t.input,R=t.avail_in,L=i.hold,P=i.bits,i.mode===v&&(i.back=-1);break}for(i.back=0;Q=i.lencode[L&(1<<i.lenbits)-1],Y=Q>>>24,J=Q>>>16&255,H=65535&Q,!(Y<=P);){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(J&&0==(240&J)){for(V=Y,q=J,X=H;Q=i.lencode[X+((L&(1<<V+q)-1)>>V)],Y=Q>>>24,J=Q>>>16&255,H=65535&Q,!(V+Y<=P);){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}L>>>=V,P-=V,i.back+=V}if(L>>>=Y,P-=Y,i.back+=Y,i.length=H,0===J){i.mode=16205;break}if(32&J){i.back=-1,i.mode=v;break}if(64&J){t.msg="invalid literal/length code",i.mode=E;break}i.extra=15&J,i.mode=16201;case 16201:if(i.extra){for(it=i.extra;P<it;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}i.length+=L&(1<<i.extra)-1,L>>>=i.extra,P-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Q=i.distcode[L&(1<<i.distbits)-1],Y=Q>>>24,J=Q>>>16&255,H=65535&Q,!(Y<=P);){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(0==(240&J)){for(V=Y,q=J,X=H;Q=i.distcode[X+((L&(1<<V+q)-1)>>V)],Y=Q>>>24,J=Q>>>16&255,H=65535&Q,!(V+Y<=P);){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}L>>>=V,P-=V,i.back+=V}if(L>>>=Y,P-=Y,i.back+=Y,64&J){t.msg="invalid distance code",i.mode=E;break}i.offset=H,i.extra=15&J,i.mode=16203;case 16203:if(i.extra){for(it=i.extra;P<it;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}i.offset+=L&(1<<i.extra)-1,L>>>=i.extra,P-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=E;break}i.mode=16204;case 16204:if(0===D)break t;if(K=C-D,i.offset>K){if(K=i.offset-K,K>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=E;break}K>i.wnext?(K-=i.wnext,F=i.wsize-K):F=i.wnext-K,K>i.length&&(K=i.length),Z=i.window}else Z=U,F=I-i.offset,K=i.length;K>D&&(K=D),D-=K,i.length-=K;do{U[I++]=Z[F++]}while(--K);0===i.length&&(i.mode=O);break;case 16205:if(0===D)break t;U[I++]=i.length,D--,i.mode=O;break;case k:if(i.wrap){for(;P<32;){if(0===R)break t;R--,L|=B[j++]<<P,P+=8}if(C-=D,t.total_out+=C,i.total+=C,4&i.wrap&&C&&(t.adler=i.check=i.flags?r(i.check,U,C,I-C):n(i.check,U,C,I-C)),C=D,4&i.wrap&&(i.flags?L:N(L))!==i.check){t.msg="incorrect data check",i.mode=E;break}L=0,P=0}i.mode=16207;case 16207:if(i.wrap&&i.flags){for(;P<32;){if(0===R)break t;R--,L+=B[j++]<<P,P+=8}if(4&i.wrap&&L!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=E;break}L=0,P=0}i.mode=16208;case 16208:G=f;break t;case E:G=p;break t;case A:return y;default:return d}return t.next_out=I,t.avail_out=D,t.next_in=j,t.avail_in=R,i.hold=L,i.bits=P,(i.wsize||C!==t.avail_out&&i.mode<E&&(i.mode<k||e!==a))&&M(t,t.output,t.next_out,C-t.avail_out)?(i.mode=A,y):($-=t.avail_in,C-=t.avail_out,t.total_in+=$,t.total_out+=C,i.total+=C,4&i.wrap&&C&&(t.adler=i.check=i.flags?r(i.check,U,C,t.next_out-C):n(i.check,U,C,t.next_out-C)),t.data_type=i.bits+(i.last?64:0)+(i.mode===v?128:0)+(i.mode===S||i.mode===x?256:0),(0===$&&0===C||e===a)&&G===h&&(G=g),G)},t.exports.inflateEnd=t=>{if(T(t))return d;let e=t.state;return e.window&&(e.window=null),t.state=null,h},t.exports.inflateGetHeader=(t,e)=>{if(T(t))return d;const i=t.state;return 0==(2&i.wrap)?d:(i.head=e,e.done=!1,h)},t.exports.inflateSetDictionary=(t,e)=>{const i=e.length;let r,s,o;return T(t)?d:(r=t.state,0!==r.wrap&&r.mode!==w?d:r.mode===w&&(s=1,s=n(s,e,i,0),s!==r.check)?p:(o=M(t,e,i,i),o?(r.mode=A,y):(r.havedict=1,h)))},t.exports.inflateInfo="pako inflate (from Nodeca project)"},241:t=>{"use strict";const e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),i=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),n=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),r=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);t.exports=(t,s,o,a,l,u,h,f)=>{const c=f.bits;let d,p,y,g,_,b,w=0,v=0,m=0,x=0,S=0,O=0,k=0,E=0,A=0,N=0,B=null;const T=new Uint16Array(16),U=new Uint16Array(16);let j,I,R,D=null;for(w=0;w<=15;w++)T[w]=0;for(v=0;v<a;v++)T[s[o+v]]++;for(S=c,x=15;x>=1&&0===T[x];x--);if(S>x&&(S=x),0===x)return l[u++]=20971520,l[u++]=20971520,f.bits=1,0;for(m=1;m<x&&0===T[m];m++);for(S<m&&(S=m),E=1,w=1;w<=15;w++)if(E<<=1,E-=T[w],E<0)return-1;if(E>0&&(0===t||1!==x))return-1;for(U[1]=0,w=1;w<15;w++)U[w+1]=U[w]+T[w];for(v=0;v<a;v++)0!==s[o+v]&&(h[U[s[o+v]]++]=v);if(0===t?(B=D=h,b=20):1===t?(B=e,D=i,b=257):(B=n,D=r,b=0),N=0,v=0,w=m,_=u,O=S,k=0,y=-1,A=1<<S,g=A-1,1===t&&A>852||2===t&&A>592)return 1;for(;;){j=w-k,h[v]+1<b?(I=0,R=h[v]):h[v]>=b?(I=D[h[v]-b],R=B[h[v]-b]):(I=96,R=0),d=1<<w-k,p=1<<O,m=p;do{p-=d,l[_+(N>>k)+p]=j<<24|I<<16|R|0}while(0!==p);for(d=1<<w-1;N&d;)d>>=1;if(0!==d?(N&=d-1,N+=d):N=0,v++,0==--T[w]){if(w===x)break;w=s[o+h[v]]}if(w>S&&(N&g)!==y){for(0===k&&(k=S),_+=m,O=w-k,E=1<<O;O+k<x&&(E-=T[O+k],!(E<=0));)O++,E<<=1;if(A+=1<<O,1===t&&A>852||2===t&&A>592)return 1;y=N&g,l[y]=S<<24|O<<16|_-u|0}}return 0!==N&&(l[_+N]=w-k<<24|64<<16|0),f.bits=S,0}},898:t=>{"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},342:t=>{"use strict";function e(t){let e=t.length;for(;--e>=0;)t[e]=0}const i=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),n=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),s=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Array(576);e(o);const a=new Array(60);e(a);const l=new Array(512);e(l);const u=new Array(256);e(u);const h=new Array(29);e(h);const f=new Array(30);function c(t,e,i,n,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=t&&t.length}let d,p,y;function g(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}e(f);const _=t=>t<256?l[t]:l[256+(t>>>7)],b=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},w=(t,e,i)=>{t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,b(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)},v=(t,e,i)=>{w(t,i[2*e],i[2*e+1])},m=(t,e)=>{let i=0;do{i|=1&t,t>>>=1,i<<=1}while(--e>0);return i>>>1},x=(t,e,i)=>{const n=new Array(16);let r,s,o=0;for(r=1;r<=15;r++)o=o+i[r-1]<<1,n[r]=o;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=m(n[e]++,e))}},S=t=>{let e;for(e=0;e<286;e++)t.dyn_ltree[2*e]=0;for(e=0;e<30;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},O=t=>{t.bi_valid>8?b(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},k=(t,e,i,n)=>{const r=2*e,s=2*i;return t[r]<t[s]||t[r]===t[s]&&n[e]<=n[i]},E=(t,e,i)=>{const n=t.heap[i];let r=i<<1;for(;r<=t.heap_len&&(r<t.heap_len&&k(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!k(e,n,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=n},A=(t,e,r)=>{let s,o,a,l,c=0;if(0!==t.sym_next)do{s=255&t.pending_buf[t.sym_buf+c++],s+=(255&t.pending_buf[t.sym_buf+c++])<<8,o=t.pending_buf[t.sym_buf+c++],0===s?v(t,o,e):(a=u[o],v(t,a+256+1,e),l=i[a],0!==l&&(o-=h[a],w(t,o,l)),s--,a=_(s),v(t,a,r),l=n[a],0!==l&&(s-=f[a],w(t,s,l)))}while(c<t.sym_next);v(t,256,e)},N=(t,e)=>{const i=e.dyn_tree,n=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,l,u=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<s;o++)0!==i[2*o]?(t.heap[++t.heap_len]=u=o,t.depth[o]=0):i[2*o+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=u<2?++u:0,i[2*l]=1,t.depth[l]=0,t.opt_len--,r&&(t.static_len-=n[2*l+1]);for(e.max_code=u,o=t.heap_len>>1;o>=1;o--)E(t,i,o);l=s;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],E(t,i,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,i[2*l]=i[2*o]+i[2*a],t.depth[l]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,i[2*o+1]=i[2*a+1]=l,t.heap[1]=l++,E(t,i,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const i=e.dyn_tree,n=e.max_code,r=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length;let u,h,f,c,d,p,y=0;for(c=0;c<=15;c++)t.bl_count[c]=0;for(i[2*t.heap[t.heap_max]+1]=0,u=t.heap_max+1;u<573;u++)h=t.heap[u],c=i[2*i[2*h+1]+1]+1,c>l&&(c=l,y++),i[2*h+1]=c,h>n||(t.bl_count[c]++,d=0,h>=a&&(d=o[h-a]),p=i[2*h],t.opt_len+=p*(c+d),s&&(t.static_len+=p*(r[2*h+1]+d)));if(0!==y){do{for(c=l-1;0===t.bl_count[c];)c--;t.bl_count[c]--,t.bl_count[c+1]+=2,t.bl_count[l]--,y-=2}while(y>0);for(c=l;0!==c;c--)for(h=t.bl_count[c];0!==h;)f=t.heap[--u],f>n||(i[2*f+1]!==c&&(t.opt_len+=(c-i[2*f+1])*i[2*f],i[2*f+1]=c),h--)}})(t,e),x(i,u,t.bl_count)},B=(t,e,i)=>{let n,r,s=-1,o=e[1],a=0,l=7,u=4;for(0===o&&(l=138,u=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)r=o,o=e[2*(n+1)+1],++a<l&&r===o||(a<u?t.bl_tree[2*r]+=a:0!==r?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=r,0===o?(l=138,u=3):r===o?(l=6,u=3):(l=7,u=4))},T=(t,e,i)=>{let n,r,s=-1,o=e[1],a=0,l=7,u=4;for(0===o&&(l=138,u=3),n=0;n<=i;n++)if(r=o,o=e[2*(n+1)+1],!(++a<l&&r===o)){if(a<u)do{v(t,r,t.bl_tree)}while(0!=--a);else 0!==r?(r!==s&&(v(t,r,t.bl_tree),a--),v(t,16,t.bl_tree),w(t,a-3,2)):a<=10?(v(t,17,t.bl_tree),w(t,a-3,3)):(v(t,18,t.bl_tree),w(t,a-11,7));a=0,s=r,0===o?(l=138,u=3):r===o?(l=6,u=3):(l=7,u=4)}};let U=!1;const j=(t,e,i,n)=>{w(t,0+(n?1:0),3),O(t),b(t,i),b(t,~i),i&&t.pending_buf.set(t.window.subarray(e,e+i),t.pending),t.pending+=i};t.exports._tr_init=t=>{U||((()=>{let t,e,s,g,_;const b=new Array(16);for(s=0,g=0;g<28;g++)for(h[g]=s,t=0;t<1<<i[g];t++)u[s++]=g;for(u[s-1]=g,_=0,g=0;g<16;g++)for(f[g]=_,t=0;t<1<<n[g];t++)l[_++]=g;for(_>>=7;g<30;g++)for(f[g]=_<<7,t=0;t<1<<n[g]-7;t++)l[256+_++]=g;for(e=0;e<=15;e++)b[e]=0;for(t=0;t<=143;)o[2*t+1]=8,t++,b[8]++;for(;t<=255;)o[2*t+1]=9,t++,b[9]++;for(;t<=279;)o[2*t+1]=7,t++,b[7]++;for(;t<=287;)o[2*t+1]=8,t++,b[8]++;for(x(o,287,b),t=0;t<30;t++)a[2*t+1]=5,a[2*t]=m(t,5);d=new c(o,i,257,286,15),p=new c(a,n,0,30,15),y=new c(new Array(0),r,0,19,7)})(),U=!0),t.l_desc=new g(t.dyn_ltree,d),t.d_desc=new g(t.dyn_dtree,p),t.bl_desc=new g(t.bl_tree,y),t.bi_buf=0,t.bi_valid=0,S(t)},t.exports._tr_stored_block=j,t.exports._tr_flush_block=(t,e,i,n)=>{let r,l,u=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<256;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),N(t,t.l_desc),N(t,t.d_desc),u=(t=>{let e;for(B(t,t.dyn_ltree,t.l_desc.max_code),B(t,t.dyn_dtree,t.d_desc.max_code),N(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*s[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),r=t.opt_len+3+7>>>3,l=t.static_len+3+7>>>3,l<=r&&(r=l)):r=l=i+5,i+4<=r&&-1!==e?j(t,e,i,n):4===t.strategy||l===r?(w(t,2+(n?1:0),3),A(t,o,a)):(w(t,4+(n?1:0),3),((t,e,i,n)=>{let r;for(w(t,e-257,5),w(t,i-1,5),w(t,n-4,4),r=0;r<n;r++)w(t,t.bl_tree[2*s[r]+1],3);T(t,t.dyn_ltree,e-1),T(t,t.dyn_dtree,i-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,u+1),A(t,t.dyn_ltree,t.dyn_dtree)),S(t),n&&O(t)},t.exports._tr_tally=(t,e,i)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=i,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(u[i]+256+1)]++,t.dyn_dtree[2*_(e)]++),t.sym_next===t.sym_end),t.exports._tr_align=t=>{w(t,2,3),v(t,256,o),(t=>{16===t.bi_valid?(b(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},292:t=>{"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";const t=i(26),e=i(297),n=i(13),r=i(516),s=i(121),o=i(591),a={deserialize:s.deserialize,serialize:s.serialize,deflate:o.deflate,inflate:o.inflate},l={PrivateKey:e.PrivateKey,PublicKey:e.PublicKey,SharedKey:e.SharedKey,Token:e.Token,Connection:t.Connection,Session:t.Session,Channel:t.Channel,Route:t.Route,State:r.State,Telekinesis:r.Telekinesis,injectFirstArg:r.injectFirstArg,blockArgEvaluation:r.blockArgEvaluation,Entrypoint:n.Entrypoint,authenticate:n.authenticate,utils:a};window.TK=l})()})();